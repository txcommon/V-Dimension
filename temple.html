<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title data-i18n="temple.pageTitle">ä¿¡ä»°åœ£æ®¿</title>
	<link rel="icon" href="./favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #0a0520 0%, #1a0b3d 50%, #2d1055 100%);
        min-height: 100vh;
        color: #fff;
        overflow-x: hidden;
        position: relative;
        padding-bottom: 80px;
    }

    /* ==================== åœ£æ®¿æŸ±å­è£…é¥° ==================== */
    .temple-pillar {
        position: fixed;
        top: 0;
        width: 60px;
        height: 100vh;
        background: linear-gradient(180deg, 
            rgba(168, 85, 247, 0.1) 0%,
            rgba(168, 85, 247, 0.05) 80%,
            transparent 100%
        );
        pointer-events: none;
        z-index: 0;
    }
    .temple-pillar.left { left: 5%; box-shadow: inset 2px 0 20px rgba(168, 85, 247, 0.3); }
    .temple-pillar.right { right: 5%; box-shadow: inset -2px 0 20px rgba(168, 85, 247, 0.3); }

    /* å…‰æŸ±æ•ˆæœ */
    .light-beam {
        position: fixed;
        width: 2px;
        height: 100vh;
        background: linear-gradient(180deg, transparent 0%, rgba(251, 191, 36, 0.3) 50%, transparent 100%);
        pointer-events: none;
        z-index: 0;
        opacity: 0.5;
    }

    /* ç²’å­å®¹å™¨ */
    .particles-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
    }
    .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: rgba(251, 191, 36, 0.6);
        border-radius: 50%;
        animation: floatUp 8s linear infinite;
    }
    @keyframes floatUp {
        0% { transform: translateY(100vh) scale(0); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(-100px) scale(1); opacity: 0; }
    }

    /* ==================== ä¸»å®¹å™¨ ==================== */
    .main-container {
        position: relative;
        z-index: 1;
        max-width: 640px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    /* ==================== é¡µé¢æ ‡é¢˜ - å¢å¼ºå‘å…‰æ•ˆæœ ==================== */
    .page-header {
        text-align: center;
        margin-bottom: 40px;
        position: relative;
    }
    .temple-title {
        font-size: 48px;
        font-weight: 700;
        letter-spacing: 6px;
        margin-bottom: 10px;
    }
    .temple-icon {
        font-weight: 400;
        font-style: normal;
        filter: drop-shadow(0 0 30px rgba(251, 191, 36, 0.8));
        margin-right: 10px;
    }
    .temple-text {
        background: linear-gradient(135deg, #ffd700 0%, #f59e0b 50%, #ffd700 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 60px rgba(251, 191, 36, 1);
        filter: drop-shadow(0 0 30px rgba(251, 191, 36, 0.8));
        font-weight: 800;
    }
    .temple-subtitle {
        font-size: 18px; /* ä¼˜åŒ–ï¼š14px â†’ 18px */
        color: rgba(251, 191, 36, 1); /* ä¼˜åŒ–ï¼šæé«˜å¯¹æ¯”åº¦ */
        font-weight: 400;
        letter-spacing: 4px;
        text-shadow: 0 0 20px rgba(251, 191, 36, 0.7);
    }
    .divider {
        width: 200px;
        height: 2px;
        background: linear-gradient(90deg, transparent, #fbbf24, transparent);
        margin: 20px auto;
        box-shadow: 0 0 30px rgba(251, 191, 36, 0.8);
    }

    /* ==================== å¡ç‰‡é€šç”¨æ ·å¼ ==================== */
    .stat-card, .action-card, .faith-claim-container {
        background: linear-gradient(135deg, rgba(30, 27, 75, 0.6) 0%, rgba(49, 46, 129, 0.6) 100%);
        border-radius: 20px;
        padding: 30px;
        border: 2px solid rgba(168, 85, 247, 0.3);
        position: relative;
        overflow: visible;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        margin-bottom: 20px;
    }
    .stat-card:hover, .action-card:hover, .faith-claim-container:hover {
        transform: translateY(-5px);
        border-color: rgba(251, 191, 36, 0.6);
        box-shadow: 0 10px 40px rgba(168, 85, 247, 0.4);
    }

    /* ==================== å¡ç‰‡æ ‡é¢˜åŒºåŸŸ - é‡æ–°è®¾è®¡å¸ƒå±€ ==================== */
    .card-header {
        font-size: 22px; /* ä¼˜åŒ–ï¼š20px â†’ 22px */
        color: #fbbf24;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        z-index: 1;
        font-weight: 600;
        flex-wrap: nowrap;
    }
    .card-header-left {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-shrink: 1;
    }
    .card-header-right {
        margin-left: auto;
        flex-shrink: 0;
    }

    /* ==================== è·å–ä¿¡ä»°æŒ‰é’® ==================== */
    .get-faith-btn {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: #1e1b4b;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 16px;
        font-weight: 700;
        border: none;
        cursor: pointer;
        box-shadow: 0 0 25px rgba(251, 191, 36, 0.9);
        transition: all 0.3s;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        white-space: nowrap;
    }
    .get-faith-btn:active {
        transform: scale(0.95);
        box-shadow: 0 0 35px rgba(251, 191, 36, 1);
    }

    /* ==================== å¸®åŠ©å›¾æ ‡ ==================== */
    .help-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px; /* ä¼˜åŒ–ï¼šå¢å¤§å›¾æ ‡ */
        height: 20px;
        border-radius: 50%;
        background: rgba(251, 191, 36, 0.25); /* ä¼˜åŒ–ï¼šæé«˜å¯¹æ¯”åº¦ */
        border: 1px solid rgba(251, 191, 36, 0.5); /* ä¼˜åŒ–ï¼šåŠ æ·±è¾¹æ¡† */
        color: #fbbf24;
        font-size: 13px; /* ä¼˜åŒ–ï¼šå¢å¤§æ–‡å­— */
        cursor: help;
        margin-left: 8px;
        transition: all 0.3s ease;
    }
    .help-icon:hover { background: rgba(251, 191, 36, 0.35); transform: scale(1.1); }

    /* Tooltip */
    .tooltip { position: relative; display: inline-flex; z-index: 100; }
    .tooltip .tooltiptext {
        visibility: hidden;
        background-color: rgba(15, 13, 40, 0.98);
        color: #fef3c7;
        text-align: left;
        border-radius: 8px;
        padding: 12px;
        position: absolute;
        z-index: 99999;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 14px; /* ä¼˜åŒ–ï¼šå¢å¤§å·¥å…·æç¤ºæ–‡å­— */
        line-height: 1.6;
        width: 300px; /* ä¼˜åŒ–ï¼šå¢å¤§å®½åº¦ */
        border: 1px solid rgba(251, 191, 36, 0.6); /* ä¼˜åŒ–ï¼šåŠ æ·±è¾¹æ¡† */
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.95);
        pointer-events: none;
    }
    .tooltip.tooltip-down .tooltiptext { bottom: auto; top: 125%; }
    .tooltip .tooltiptext::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: rgba(15, 13, 40, 0.98) transparent transparent transparent;
    }
    .tooltip.tooltip-down .tooltiptext::after {
        top: auto;
        bottom: 100%;
        border-color: transparent transparent rgba(15, 13, 40, 0.98) transparent;
    }
    .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; pointer-events: auto; }

    /* ==================== ç»Ÿè®¡é¡¹ - æ˜¾è‘—å¢å¤§å­—ä½“ ==================== */
    .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0; /* ä¼˜åŒ–ï¼šå¢åŠ å†…è¾¹è· */
        border-bottom: 1px solid rgba(168, 85, 247, 0.3); /* ä¼˜åŒ–ï¼šåŠ æ·±åˆ†éš”çº¿ */
        position: relative;
        z-index: 1;
    }
    .stat-item:last-child { border-bottom: none; }
    .stat-label { 
        font-size: 18px; /* ä¼˜åŒ–ï¼š16px â†’ 18px */
        color: rgba(255, 255, 255, 0.95); /* ä¼˜åŒ–ï¼šæ˜¾è‘—æé«˜å¯¹æ¯”åº¦ */
        font-weight: 500;
    }
    .stat-value { 
        font-size: 20px; /* ä¼˜åŒ–ï¼š18px â†’ 20px */
        font-weight: 700; 
        color: #fff; 
    }
    .stat-value.highlight { 
        color: #ffd700; /* ä¼˜åŒ–ï¼šä½¿ç”¨æ›´äº®çš„é‡‘è‰² */
        text-shadow: 0 0 15px rgba(255, 215, 0, 0.7); /* ä¼˜åŒ–ï¼šå¢å¼ºå‘å…‰æ•ˆæœ */
    }

    /* ==================== å¼€å¯é‡‘åº“å¡ç‰‡ ==================== */
    .distribute-card {
        background: linear-gradient(135deg, rgba(30, 27, 75, 0.7) 0%, rgba(49, 46, 129, 0.7) 100%);
        border: 2px solid rgba(251, 191, 36, 0.5); /* ä¼˜åŒ–ï¼šåŠ æ·±è¾¹æ¡† */
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
        backdrop-filter: blur(10px);
    }
    .distribute-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        gap: 15px;
    }
    .distribute-title {
        font-size: 24px; /* ä¼˜åŒ–ï¼š20px â†’ 24px */
        color: #fbbf24;
        font-weight: 700; /* ä¼˜åŒ–ï¼šåŠ ç²— */
        display: flex;
        align-items: center;
        gap: 8px;
        flex-shrink: 1;
        text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); /* æ·»åŠ å‘å…‰æ•ˆæœ */
    }
    .countdown {
        font-size: 24px; /* ä¼˜åŒ–ï¼š20px â†’ 24px */
        font-weight: 700;
        color: #ffd700; /* ä¼˜åŒ–ï¼šæ›´äº®çš„é‡‘è‰² */
        letter-spacing: 2px;
        text-shadow: 0 0 25px rgba(251, 191, 36, 0.7); /* ä¼˜åŒ–ï¼šå¢å¼ºå‘å…‰ */
        white-space: nowrap;
        flex-shrink: 0;
    }
    .purse-balance {
        text-align: center;
        font-size: 28px; /* ä¼˜åŒ–ï¼š24px â†’ 28px */
        color: #ffd700; /* ä¼˜åŒ–ï¼šæ›´äº®çš„é‡‘è‰² */
        margin-bottom: 15px;
        font-weight: 800; /* ä¼˜åŒ–ï¼šåŠ ç²— */
        text-shadow: 0 0 20px rgba(251, 191, 36, 0.6);
    }

    /* è¿›åº¦æ¡ */
    .progress-container { margin-bottom: 15px; }
    .progress-label {
        display: flex;
        justify-content: space-between;
        font-size: 16px; /* ä¼˜åŒ–ï¼š13px â†’ 16px */
        color: rgba(255, 255, 255, 0.9); /* ä¼˜åŒ–ï¼šæé«˜å¯¹æ¯”åº¦ */
        margin-bottom: 10px;
        font-weight: 500;
    }
    .progress-bar {
        height: 12px; /* ä¼˜åŒ–ï¼šå¢å¤§è¿›åº¦æ¡é«˜åº¦ */
        background: rgba(255, 255, 255, 0.15); /* ä¼˜åŒ–ï¼šæé«˜å¯¹æ¯”åº¦ */
        border-radius: 6px;
        overflow: hidden;
    }
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
        border-radius: 6px;
        transition: width 0.8s ease;
        box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
    }
    .progress-fill.completed { background: linear-gradient(90deg, #10b981 0%, #34d399 100%); }

    /* ==================== è¾“å…¥æ¡† ==================== */
    .input-group { margin-bottom: 15px; }
    .input-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(0, 0, 0, 0.4); /* ä¼˜åŒ–ï¼šåŠ æ·±èƒŒæ™¯ */
        border: 1px solid rgba(168, 85, 247, 0.4); /* ä¼˜åŒ–ï¼šåŠ æ·±è¾¹æ¡† */
        border-radius: 12px;
        padding: 12px 15px;
        transition: all 0.3s;
    }
    .input-wrapper:focus-within {
        border-color: #fbbf24;
        box-shadow: 0 0 25px rgba(251, 191, 36, 0.4); /* ä¼˜åŒ–ï¼šå¢å¼ºå‘å…‰ */
    }
    .input-field {
        flex: 1;
        background: transparent;
        border: none;
        color: #fff;
        font-size: 17px; /* ä¼˜åŒ–ï¼š16px â†’ 17px */
        font-weight: 600;
        outline: none;
        min-width: 0;
        -webkit-text-size-adjust: 100%;
    }
    .input-field::placeholder { color: rgba(255, 255, 255, 0.4); }
    .input-field::-webkit-inner-spin-button,
    .input-field::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    .input-field[type=number] { -moz-appearance: textfield; }

    .max-btn {
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.5) 0%, rgba(139, 92, 246, 0.5) 100%);
        border: 1px solid rgba(168, 85, 247, 0.6); /* ä¼˜åŒ–ï¼šåŠ æ·±è¾¹æ¡† */
        border-radius: 8px;
        padding: 8px 16px;
        color: #fbbf24;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        box-shadow: 0 0 10px rgba(168, 85, 247, 0.3);
    }
    .max-btn:active { transform: scale(0.95); }

    .balance-display {
        font-size: 18px; /* ä¼˜åŒ–ï¼š15px â†’ 18px */
        color: rgba(251, 191, 36, 0.95); /* ä¼˜åŒ–ï¼šæé«˜å¯¹æ¯”åº¦ */
        font-weight: 700; /* ä¼˜åŒ–ï¼šåŠ ç²— */
        white-space: nowrap;
        text-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
    }

    /* ==================== æŒ‰é’® - å¢å¤§å­—ä½“ ==================== */
    .temple-btn {
        width: 100%;
        padding: 16px;
        border-radius: 12px;
        font-size: 17px; /* ä¼˜åŒ–ï¼š16px â†’ 17px */
        font-weight: 700;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        z-index: 1;
    }
    .temple-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
        z-index: -1;
    }
    .temple-btn:active::before { width: 300px; height: 300px; }

    .btn-primary {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: #1e1b4b;
        box-shadow: 0 5px 25px rgba(251, 191, 36, 0.5); /* ä¼˜åŒ–ï¼šå¢å¼ºé˜´å½± */
    }
    .btn-primary:active { transform: scale(0.98); }
    .btn-secondary {
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.5) 0%, rgba(139, 92, 246, 0.5) 100%);
        color: #fbbf24;
        border: 1px solid rgba(168, 85, 247, 0.6); /* ä¼˜åŒ–ï¼šåŠ æ·±è¾¹æ¡† */
        box-shadow: 0 5px 20px rgba(168, 85, 247, 0.3);
    }
    .btn-disabled {
        background: rgba(100, 100, 100, 0.4); /* ä¼˜åŒ–ï¼šåŠ æ·±èƒŒæ™¯ */
        color: rgba(255, 255, 255, 0.4);
        cursor: not-allowed;
        box-shadow: none;
        border: none; /* æ·»åŠ ï¼šç§»é™¤è¾¹æ¡† */
    }
    .btn-disabled::before { display: none; }

    /* æŒ‰é’®ç»„ */
    .button-group {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 20px;
    }

    /* ==================== åº•éƒ¨å¯¼èˆª - ä¿æŒåŸæ · ==================== */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        display: flex;
        justify-content: space-around;
        padding: 12px 0 20px;
        background: rgba(26, 11, 61, 0.8);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(168, 85, 247, 0.2);
        box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        transition: all 0.3s;
        padding: 8px 16px;
        border-radius: 12px;
    }
    .nav-item.active { background: rgba(168, 85, 247, 0.15); }
    .nav-icon { font-size: 24px; transition: all 0.3s; }
    .nav-item.active .nav-icon { color: #a855f7; transform: scale(1.1); }
    .nav-item:not(.active) .nav-icon { color: rgba(255, 255, 255, 0.4); }
    .nav-label { font-size: 11px; font-weight: 600; transition: all 0.3s; }
    .nav-item.active .nav-label { color: #a855f7; }
    .nav-item:not(.active) .nav-label { color: rgba(255, 255, 255, 0.4); }

    /* ==================== é”®ç›˜å¤„ç† ==================== */
    @media (hover: none) and (pointer: coarse) {
        body.keyboard-open .bottom-nav {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            transform: translateY(100%) !important;
            pointer-events: none !important;
        }
        body.keyboard-open .main-container {
            padding-bottom: 30px !important;
        }
    }

    /* iOS ä¸“ç”¨å¼ºåˆ¶éšè— */
    @supports (-webkit-touch-callout: none) {
        body.keyboard-open .bottom-nav,
        body.ios-keyboard-open .bottom-nav {
            display: none !important;
            visibility: hidden !important;
            transform: translateY(150%) !important;
            position: fixed !important;
            bottom: -100px !important;
            pointer-events: none !important;
            z-index: -1 !important;
        }
    }

    /* é€šç”¨è¾“å…¥çŠ¶æ€ç±» */
    .input-focused .bottom-nav {
        display: none !important;
        visibility: hidden !important;
        transform: translateY(100%) !important;
    }

    /* ==================== Loading & Toast ==================== */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }
    .loading-overlay.show { display: flex; }
    .loading-content { text-align: center; color: #fff; }
    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(251, 191, 36, 0.3);
        border-top-color: #fbbf24;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 12px;
    }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .loading-text { font-size: 14px; }

    .toast {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 16px 24px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        z-index: 10000;
        animation: toastIn 0.3s ease;
    }
    .toast-success { background: rgba(16, 185, 129, 0.9); color: #fff; }
    .toast-error { background: rgba(239, 68, 68, 0.9); color: #fff; }
    @keyframes toastIn { from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } to { opacity: 1; transform: translate(-50%, -50%) scale(1); } }

    /* ==================== å“åº”å¼è°ƒæ•´ ==================== */
    @media (max-width: 768px) {
        .temple-title { font-size: 32px; letter-spacing: 4px; }
        .temple-icon { font-size: 32px; }
        .temple-subtitle { font-size: 16px; letter-spacing: 3px; } /* å“åº”è°ƒæ•´ */
        .main-container { padding: 20px 15px; }
        .button-group { grid-template-columns: 1fr; gap: 8px; }
        .stat-card, .action-card, .faith-claim-container { padding: 20px 15px; border-width: 1px; }
        .distribute-card { padding: 15px; }
        
        /* ç§»åŠ¨ç«¯å­—ä½“è°ƒæ•´ */
        .card-header { font-size: 20px; } /* å“åº”è°ƒæ•´ */
        .distribute-title { font-size: 20px; } /* å“åº”è°ƒæ•´ */
        .countdown { font-size: 20px; letter-spacing: 1px; }
        .purse-balance { font-size: 22px; } /* å“åº”è°ƒæ•´ */
        .balance-display { font-size: 16px; } /* å“åº”è°ƒæ•´ */
        .stat-item { padding: 12px 0; }
        .stat-label, .stat-value { font-size: 16px; } /* å“åº”è°ƒæ•´ */
        .stat-label { font-size: 16px; }
        .stat-value { font-size: 18px; }
        .input-field { font-size: 16px; padding: 12px 15px; } /* å“åº”è°ƒæ•´ */
        .temple-btn { padding: 14px; font-size: 16px; } /* å“åº”è°ƒæ•´ */
        .get-faith-btn { font-size: 14px; padding: 6px 12px; } /* å“åº”è°ƒæ•´ */
        .temple-pillar, .light-beam { display: none; }
        .particles-container { opacity: 0.5; }
        .tooltip .tooltiptext { width: 280px; font-size: 13px; padding: 10px; } /* å“åº”è°ƒæ•´ */
        .progress-label { font-size: 14px; } /* å“åº”è°ƒæ•´ */
    }

    @media (max-width: 480px) {
        .temple-title { font-size: 28px; letter-spacing: 3px; }
        .temple-icon { font-size: 28px; }
        .main-container { padding: 15px 10px; }
        .stat-card, .action-card, .faith-claim-container { padding: 15px 12px; }
        
        /* å°å±å¹•å­—ä½“è°ƒæ•´ */
        .card-header { font-size: 18px; } /* å“åº”è°ƒæ•´ */
        .distribute-title { font-size: 18px; } /* å“åº”è°ƒæ•´ */
        .countdown { font-size: 18px; }
        .purse-balance { font-size: 20px; } /* å“åº”è°ƒæ•´ */
        .stat-label { font-size: 15px; } /* å“åº”è°ƒæ•´ */
        .stat-value { font-size: 17px; } /* å“åº”è°ƒæ•´ */
        .button-group { gap: 6px; }
        .get-faith-btn { font-size: 13px; padding: 5px 10px; } /* å“åº”è°ƒæ•´ */
    }
</style>
</head>
<body>
    <!-- åœ£æ®¿æŸ±å­è£…é¥° -->
    <div class="temple-pillar left"></div>
    <div class="temple-pillar right"></div>

    <!-- å…‰æŸ±æ•ˆæœ -->
    <div class="light-beam" style="left: 15%;"></div>
    <div class="light-beam" style="left: 85%;"></div>
    <div class="light-beam" style="left: 30%;"></div>
    <div class="light-beam" style="left: 70%;"></div>

    <!-- ç²’å­èƒŒæ™¯å®¹å™¨ -->
    <div class="particles-container" id="particlesContainer"></div>

    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <div class="main-container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="temple-title">
                <span class="temple-icon">ğŸ›ï¸</span>
                <span class="temple-text">ä¿¡ä»°åœ£æ®¿</span>
            </h1>
            <div class="divider"></div>
            <p class="temple-subtitle">TEMPLE OF FORTUNA</p>
        </div>

        <!-- åœ£æ®¿æ¦‚å†µ -->
        <div class="stat-card">
			<div class="card-header">
				<div class="card-header-left">
					ğŸ“Š åœ£æ®¿æ¦‚å†µ
					<span class="tooltip">
						<span class="help-icon">?</span>
						<span class="tooltiptext">ğŸ’¡ æ˜¾ç¤ºå…¨ç½‘è´¨æŠ¼å’Œåˆ†çº¢çš„ç»Ÿè®¡æ•°æ®ã€‚<br><br>â€¢ æ¯VDSç´¯è®¡åˆ†çº¢ = æ¯è´¨æŠ¼1ä¸ªVDSä»å¼€å§‹åˆ°ç°åœ¨ç´¯è®¡è·å¾—çš„VIDå¥–åŠ±<br><br>â€¢ æœ¬æœŸ1VDSå°†åˆ†çº¢ = å¦‚æœç°åœ¨å¼€å¯é‡‘åº“ï¼Œæ¯1ä¸ªVDSå¯ä»¥åˆ†åˆ°çš„VIDå¥–åŠ±</span>
					</span>
				</div>
				<div class="card-header-right">
					<button class="get-faith-btn" onclick="window.location.href='trinity.html'">
						è·å–ä¿¡ä»°
					</button>
				</div>
			</div>

            <div class="stat-item">
                <span class="stat-label">å½“å‰è´¨æŠ¼æ€»é¢</span>
                <span class="stat-value highlight" id="totalStaked">0 VDS</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">åœ£æ®¿åˆ†çº¢æ€»é¢</span>
                <span class="stat-value" id="totalDistributed">0 VID</span>
            </div>
            <!-- åˆ é™¤ï¼šé‡‘åº“å¾…åˆ†çº¢é¢è¿™ä¸€è¡Œ -->
            <div class="stat-item">
                <span class="stat-label">åˆçº¦å¾…é¢†å–åˆ†çº¢ä½™é¢</span>
                <span class="stat-value" id="contractBalance">0 VID</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">è´¨æŠ¼1æšVDSç´¯è®¡åˆ†çº¢</span>
                <span class="stat-value highlight" id="accRewardPerShare">0 VID</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æœ¬æœŸè´¨æŠ¼1æšVDSåˆ†çº¢</span>
                <span class="stat-value highlight" id="estimatedNextDividend">0 VID</span>
            </div>
        </div>

        <!-- å¼€å¯é‡‘åº“ -->
        <div class="distribute-card">
            <div class="distribute-header">
                <span class="distribute-title">
                    âš¡ å¼€å¯é‡‘åº“
                    <span class="tooltip">
                        <span class="help-icon">?</span>
                        <span class="tooltiptext">ğŸ’¡ æ¯24å°æ—¶å¯è§¦å‘ä¸€æ¬¡åˆ†çº¢ï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ã€‚é‡‘åº“ä¸­çš„VIDå°†æŒ‰è´¨æŠ¼æ¯”ä¾‹åˆ†é…ç»™æ‰€æœ‰è´¨æŠ¼è€…ã€‚<br><br>âš ï¸ éœ€è¦å…¨ç½‘æ€»è´¨æŠ¼è¾¾åˆ°8888 VDSæ‰èƒ½å¼€å¯åˆ†çº¢ã€‚</span>
                    </span>
                </span>
                <span class="countdown" id="nextDistribution">--:--:--</span>
            </div>
            <div class="purse-balance">
                å¾…åˆ†çº¢: <span id="purseBalanceMain">0</span> VID
            </div>

            <div class="progress-container">
                <div class="progress-label">
                    <span>å¼€å¯é‡‘åº“è¿›åº¦</span>
                    <span><span id="progressAmount">0</span> / 888 VDS</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <button class="temple-btn btn-primary" onclick="handleDistribute()" id="distributeBtn">
                <span>å¼€å¯é‡‘åº“åˆ†çº¢</span>
            </button>
        </div>

        <!-- æˆ‘çš„ä¿¡ä»° + é¢†å–ç¦æŠ¥ -->
        <div class="faith-claim-container">
			<div class="card-header">
				<div class="card-header-left">
					ğŸ’ æˆ‘çš„ä¿¡ä»°
					<span class="tooltip tooltip-down">
						<span class="help-icon">?</span>
						<span class="tooltiptext">ğŸ’¡ æ˜¾ç¤ºæ‚¨çš„è´¨æŠ¼å’Œå¥–åŠ±æƒ…å†µã€‚<br><br>â€¢ å¾…é¢†ç¦æŠ¥ä¼šå®æ—¶ç´¯ç§¯ï¼Œéšæ—¶å¯ä»¥é¢†å–<br><br>â€¢ æœ¬æœŸé¢„è®¡ç¦æŠ¥ = å¦‚æœç°åœ¨å¼€å¯é‡‘åº“ï¼Œæ‚¨é¢„è®¡å¯ä»¥è·å¾—çš„VIDå¥–åŠ±</span>
					</span>
				</div>
			</div>
            <div class="stat-item">
                <span class="stat-label">å½“å‰è´¨æŠ¼</span>
                <span class="stat-value highlight" id="myStaked">0 VDS</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">å¾…é¢†ç¦æŠ¥</span>
                <span class="stat-value highlight" id="pendingReward">0 VID</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ç´¯è®¡è·å¾—ç¦æŠ¥</span>
                <span class="stat-value" id="totalClaimed">0 VID</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æœ¬æœŸé¢„è®¡ç¦æŠ¥</span>
                <span class="stat-value" id="estimatedReward">0 VID</span>
            </div>
            <!-- æ–°å¢ï¼šåˆ†çº¢åº”æ‰£ç¨ -->
            <div class="stat-item">
                <span class="stat-label">åˆ†çº¢åº”æ‰£ç¨</span>
                <span class="stat-value" id="dividendTax">0 VDS</span>
            </div>

            <button class="temple-btn btn-primary" onclick="handleClaimReward()" id="claimBtn">
                <span>é¢†å–ç¦æŠ¥</span>
            </button>
        </div>

        <!-- è´¨æŠ¼ä¿¡ä»° -->
        <div class="action-card">
            <div class="card-header">
                <div class="card-header-left">
                    <span>ğŸ•¯ï¸ è´¨æŠ¼ä¿¡ä»°</span>
                    <span class="tooltip">
                        <span class="help-icon">?</span>
                        <span class="tooltiptext">ğŸ’¡ è´¨æŠ¼VDSä»£å¸å³å¯è·å¾—VIDåˆ†çº¢å¥–åŠ±ã€‚<br><br>â€¢ éœ€è¦å…ˆç‚¹å‡»"æˆæƒVDS"æŒ‰é’®æˆæƒä»£å¸<br><br>â€¢ æˆæƒæˆåŠŸåæ‰èƒ½è´¨æŠ¼<br><br>â€¢ æœ€å°è´¨æŠ¼æ•°é‡ä¸º0.01 VDS<br><br>â€¢ å…¨ç½‘æ€»è´¨æŠ¼è¾¾åˆ°8888 VDSå³å¯å¼€å¯åˆ†çº¢</span>
                    </span>
                </div>
                <div class="card-header-right">
                    <span class="balance-display">ä½™é¢: <span id="vdsBalance">0</span> VDS</span>
                </div>
            </div>
            
            <div class="input-group">
                <div class="input-wrapper">
                    <input type="number" class="input-field" id="stakeAmount" placeholder="è¾“å…¥è´¨æŠ¼æ•°é‡" min="0.01" step="0.01">
                    <button class="max-btn" onclick="setMaxStake()">æœ€å¤§</button>
                </div>
            </div>

            <button class="temple-btn btn-primary" onclick="handleApproveOrStake()" id="stakeBtn">
                <span id="stakeBtnText">æˆæƒ VDS</span>
            </button>
        </div>

        <!-- è§£æŠ¼ç®¡ç† -->
        <div class="action-card">
			<div class="card-header">
				<div class="card-header-left">
					â³ è§£æŠ¼ç®¡ç†
					<span class="tooltip">
						<span class="help-icon">?</span>
						<span class="tooltiptext">âš ï¸ è§£æŠ¼è§„åˆ™è¯´æ˜ï¼š<br><br>â€¢ å‘èµ·è§£æŠ¼åéœ€ç­‰å¾…3å¤©æ‰èƒ½æå–<br><br>â€¢ ç­‰å¾…æœŸé—´å¯ä»¥å–æ¶ˆè§£æŠ¼ï¼Œä»£å¸å°†æ¢å¤åˆ°è´¨æŠ¼çŠ¶æ€<br><br>â€¢ è§£æŠ¼ç­‰å¾…æ˜¾ç¤ºæ‚¨æ­£åœ¨ç­‰å¾…æå–çš„VDSæ•°é‡å’Œå‰©ä½™æ—¶é—´<br><br>â€¢ å…è®¸è§£æŠ¼é‡‘é¢ = å½“å‰è´¨æŠ¼VDS - åˆ†çº¢åº”æ‰£ç¨VDS</span>
					</span>
				</div>
			</div>
            
            <!-- ä¿®æ”¹ï¼šæ˜¾ç¤ºç¨åå¯è§£æŠ¼é‡‘é¢ -->
            <div class="stat-item" style="margin-bottom: 15px;">
                <span class="stat-label">å…è®¸è§£æŠ¼é‡‘é¢</span>
                <div class="stat-value highlight" id="currentStaked">
                    <div>0 VDS</div>
                </div>
            </div>

            <div class="stat-item" style="margin-bottom: 20px;">
                <span class="stat-label">è§£æŠ¼ç­‰å¾…é‡‘é¢</span>
                <span class="stat-value" id="waitingUnstake">
                    <span id="pendingUnstakeAmount">0</span>
                    <span style="color: #fbbf24; font-size: 14px; margin-left: 10px;" id="unlockTime"></span>
                </span>
            </div>

            <div class="input-group">
                <div class="input-wrapper">
                    <input type="number" class="input-field" id="unstakeAmount" placeholder="è¾“å…¥è§£æŠ¼æ•°é‡" min="0.01" step="0.01">
                    <button class="max-btn" onclick="setMaxUnstake()">æœ€å¤§</button>
                </div>
            </div>

            <button class="temple-btn btn-primary" onclick="handleRequestUnstake()" id="unstakeBtn">
                <span>å‘èµ·è§£æŠ¼</span>
            </button>

            <div class="button-group">
                <button class="temple-btn btn-secondary" onclick="handleCancelUnstake()" id="cancelUnstakeBtn">
                    <span>å–æ¶ˆè§£æŠ¼</span>
                </button>
                <button class="temple-btn btn-secondary" onclick="handleWithdraw()" id="withdrawBtn">
                    <span>æå–ä»£å¸</span>
                </button>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav">
        <div class="nav-item" onclick="switchPage('home')" data-page="home"><div class="nav-icon">ğŸ </div><div class="nav-label">é¦–é¡µ</div></div>
        <div class="nav-item" onclick="switchPage('stats')" data-page="stats"><div class="nav-icon">ğŸ“Š</div><div class="nav-label">æ•°æ®</div></div>
        <div class="nav-item" onclick="switchPage('swap')" data-page="swap"><div class="nav-icon">ğŸ’°</div><div class="nav-label">å…‘æ¢</div></div>
        <div class="nav-item active" onclick="switchPage('temple')" data-page="temple"><div class="nav-icon">ğŸ›ï¸</div><div class="nav-label">åœ£æ®¿</div></div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/web3-manager.js"></script>
    <script>
        // ==================== å¸¸é‡ ====================
        const MIN_STAKE_AMOUNT = 0.01;  // æœ€å°è´¨æŠ¼ 0.01 VDS
        const MIN_STAKE_FOR_DIVIDENDS = 888; // å¼€å¯åˆ†çº¢æœ€ä½è´¨æŠ¼
        const DISTRIBUTION_INTERVAL = 24 * 3600; // 24å°æ—¶
        const UNSTAKE_LOCK_PERIOD = 3 * 86400; // 3å¤©

        // ==================== çŠ¶æ€ ====================
        let templeContract = null;
        let vdsContract = null;
        let countdownInterval = null;
        let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        let state = {
            connected: false,
            // åœ£æ®¿ä¿¡æ¯
            totalStaked: 0,
            totalDistributed: 0,
            purseBal: 0,
            contractBal: 0,
            accRewardPerShare: 0,
            estimatedNextDividend: 0,
            nextDistributionTime: 0,
            // ç”¨æˆ·ä¿¡æ¯
            stakedAmount: 0,
            totalRewardDistributed: 0,
            estimateVIDReward: 0,
            pendingRewardAmount: 0,
            pendingUnstakeAmount: 0,
            unlockTime: 0,
            // æ–°å¢ï¼šåˆ†çº¢ç¨ï¼ˆVDSæ•°é‡ï¼‰
            dividendTax: 0,
            // ä½™é¢
            vdsBalance: 0,
            // æˆæƒçŠ¶æ€
            isApproved: false
        };

        // ==================== å·¥å…·å‡½æ•° ====================
        function showLoading(text = 'åŠ è½½ä¸­...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('show');
        }
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        // æ ¼å¼åŒ–æ•°å­— - å®Œæ•´æ˜¾ç¤ºï¼Œä¿ç•™3ä½å°æ•°
        function formatNumber(num, decimals = 8, displayDecimals = 3) {
            // 1. è½¬æ¢ä¸ºå®é™…æ•°é‡
            const actual = Number(num) / Math.pow(10, decimals);
            if (actual === 0) return "0";
            
            // 2. å‘ä¸‹å–æ•´åˆ°displayDecimalsä½å°æ•°
            const factor = Math.pow(10, displayDecimals);
            const floored = Math.floor(actual * factor) / factor;
            
            // 3. è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶å»é™¤æœ«å°¾çš„0
            return floored.toString().replace(/(\.\d*?)0+$/, '$1').replace(/\.$/, '');
        }

        // æ ¼å¼åŒ–å€’è®¡æ—¶
        function formatCountdown(seconds) {
            if (seconds <= 0) return 'æ—¶é—´å·²æ»¡è¶³';
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        // æ ¼å¼åŒ–è§£é”æ—¶é—´
        function formatUnlockTime(timestamp) {
            const now = Math.floor(Date.now() / 1000);
            const remaining = timestamp - now;
            if (remaining <= 0) return 'å¯æå–';
            const d = Math.floor(remaining / 86400);
            const h = Math.floor((remaining % 86400) / 3600);
            const m = Math.floor((remaining % 3600) / 60);
            if (d > 0) return `${d}å¤©${h}æ—¶å`;
            if (h > 0) return `${h}æ—¶${m}åˆ†å`;
            return `${m}åˆ†é’Ÿå`;
        }

        // ==================== é¡µé¢å¯¼èˆª ====================
        function switchPage(page) {
            const pages = { home: 'index.html', stats: 'data.html', swap: 'exchange.html', temple: 'temple.html' };
            if (pages[page] && page !== 'temple') window.location.href = pages[page];
        }

        // ==================== ç²’å­æ•ˆæœ ====================
        function initParticles() {
            const container = document.getElementById('particlesContainer');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (6 + Math.random() * 4) + 's';
                container.appendChild(particle);
            }
        }

        // ==================== é”®ç›˜å¤„ç† ====================
        function initKeyboardHandler() {
            if (!isMobile) return;

            const inputs = document.querySelectorAll('input[type="number"]');
            const body = document.body;
            let isKeyboardOpen = false;

            // iOS ä¸“ç”¨å¤„ç†
            if (isIOS) {
                inputs.forEach(input => {
                    input.addEventListener('focus', function() {
                        body.classList.add('keyboard-open');
                        body.classList.add('ios-keyboard-open');
                        body.classList.add('input-focused');
                        isKeyboardOpen = true;

                        // å¼ºåˆ¶éšè—åº•éƒ¨å¯¼èˆª
                        setTimeout(() => {
                            const nav = document.querySelector('.bottom-nav');
                            if (nav) {
                                nav.style.cssText = `
                                    display: none !important;
                                    visibility: hidden !important;
                                    transform: translateY(150%) !important;
                                    position: fixed !important;
                                    bottom: -100px !important;
                                    pointer-events: none !important;
                                    z-index: -1 !important;
                                `;
                            }
                        }, 50);

                        // æ»šåŠ¨åˆ°è¾“å…¥æ¡†å¯è§
                        setTimeout(() => {
                            input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 400);
                    });

                    input.addEventListener('blur', function() {
                        setTimeout(() => {
                            body.classList.remove('keyboard-open');
                            body.classList.remove('ios-keyboard-open');
                            body.classList.remove('input-focused');
                            isKeyboardOpen = false;

                            const nav = document.querySelector('.bottom-nav');
                            if (nav) nav.style.cssText = '';
                        }, 300);
                    });
                });

                // VisualViewport API
                if (window.visualViewport) {
                    let lastHeight = window.visualViewport.height;
                    window.visualViewport.addEventListener('resize', () => {
                        const currentHeight = window.visualViewport.height;
                        const heightDiff = lastHeight - currentHeight;

                        if (heightDiff > 100) {
                            body.classList.add('keyboard-open');
                            body.classList.add('ios-keyboard-open');
                            isKeyboardOpen = true;
                        } else if (heightDiff < -50) {
                            setTimeout(() => {
                                body.classList.remove('keyboard-open');
                                body.classList.remove('ios-keyboard-open');
                                isKeyboardOpen = false;
                            }, 200);
                        }
                        lastHeight = currentHeight;
                    });
                }
            }
            // Android å¤„ç†
            else {
                let originalViewportHeight = window.innerHeight;

                window.addEventListener('resize', function() {
                    const newHeight = window.innerHeight;
                    const heightDiff = originalViewportHeight - newHeight;

                    if (heightDiff > 250) {
                        if (!isKeyboardOpen) {
                            body.classList.add('keyboard-open');
                            isKeyboardOpen = true;
                        }
                    } else if (heightDiff < 50 && isKeyboardOpen) {
                        body.classList.remove('keyboard-open');
                        isKeyboardOpen = false;
                    }
                });

                inputs.forEach(input => {
                    input.addEventListener('focus', function() {
                        setTimeout(() => {
                            if (!isKeyboardOpen) {
                                body.classList.add('keyboard-open');
                                isKeyboardOpen = true;
                            }
                        }, 300);
                    });

                    input.addEventListener('blur', function() {
                        setTimeout(() => {
                            if (isKeyboardOpen) {
                                body.classList.remove('keyboard-open');
                                isKeyboardOpen = false;
                            }
                        }, 200);
                    });
                });
            }

            // ç‚¹å‡»å…¶ä»–åŒºåŸŸå…³é—­é”®ç›˜
            document.addEventListener('touchstart', function(e) {
                if (isKeyboardOpen) {
                    let isInput = false;
                    inputs.forEach(input => {
                        if (e.target === input || input.contains(e.target)) isInput = true;
                    });
                    if (!isInput && e.target.className !== 'max-btn') {
                        document.activeElement?.blur();
                    }
                }
            }, { passive: true });
        }

		// ==================== è¾“å…¥è¾…åŠ© ====================
		function setMaxStake() {
			const vdsBalance = state.vdsBalance / 1e8;
			document.getElementById('stakeAmount').value = vdsBalance.toFixed(2);
		}

		function setMaxUnstake() {
			// ä½¿ç”¨stateä¸­çš„ç¨åå¯è§£æŠ¼é‡‘é¢
			const availableForUnstake = state.availableForUnstake / 1e8;
			document.getElementById('unstakeAmount').value = availableForUnstake.toFixed(2);
		}

        // ==================== æ•°æ®åŠ è½½ ====================
        async function loadData() {
            try {
                if (typeof web3Manager === 'undefined') {
                    setTimeout(loadData, 500);
                    return;
                }

                if (!web3Manager.web3) {
                    await web3Manager.init();
                }

                // æ£€æµ‹é’±åŒ…è¿æ¥
                if (window.ethereum && window.ethereum.selectedAddress) {
                    web3Manager.account = window.ethereum.selectedAddress;
                    web3Manager.isConnected = true;
                    state.connected = true;
                }

                // åˆå§‹åŒ–åˆçº¦
                templeContract = web3Manager.getContract(TEMPLE_ABI, CONFIG.CONTRACTS.Temple);
                vdsContract = web3Manager.getContract(ERC20_ABI, CONFIG.CONTRACTS.VDS);

                if (!templeContract || !vdsContract) {
                    console.error('æ— æ³•åˆå§‹åŒ–åˆçº¦');
                    return;
                }

                // åŠ è½½åœ£æ®¿ä¿¡æ¯
                const templeInfo = await templeContract.methods.getTempleInfo().call();
                state.totalStaked = Number(templeInfo.totalStaked);
                state.totalDistributed = Number(templeInfo.totalDistributed);
                state.purseBal = Number(templeInfo.purseBal);
                state.contractBal = Number(templeInfo.contractBal);
                state.accRewardPerShare = Number(templeInfo.accRewardPerShare);
                state.estimatedNextDividend = Number(templeInfo.estimatedNextDividend);
                state.nextDistributionTime = Number(templeInfo.nextDistributionTime);

                // åŠ è½½ç”¨æˆ·ä¿¡æ¯
                if (state.connected) {
                    const [userInfo, vdsBalance, allowance, dividendTax] = await Promise.all([
                        templeContract.methods.getUserInfo().call({ from: web3Manager.account }),
                        vdsContract.methods.balanceOf(web3Manager.account).call(),
                        vdsContract.methods.allowance(web3Manager.account, CONFIG.CONTRACTS.Temple).call(),
                        // æ–°å¢ï¼šè·å–åˆ†çº¢ç¨
                        templeContract.methods.getDividendTax().call({ from: web3Manager.account })
                    ]);

                    state.stakedAmount = Number(userInfo.stakedAmount);
                    state.totalRewardDistributed = Number(userInfo.totalRewardDistributed);
                    state.estimateVIDReward = Number(userInfo.estimateVIDReward);
                    state.pendingRewardAmount = Number(userInfo.pendingRewardAmount);
                    state.pendingUnstakeAmount = Number(userInfo.pendingUnstakeAmount);
                    state.unlockTime = Number(userInfo.unlockTime);
                    state.vdsBalance = Number(vdsBalance);
                    state.isApproved = BigInt(allowance) > BigInt('1000000000000000000000000000');
                    
                    // æ–°å¢ï¼šä¿å­˜åˆ†çº¢ç¨ï¼ˆVDSæ•°é‡ï¼‰
                    state.dividendTax = Number(dividendTax);
                }

                // æ›´æ–°UI
                updateUI();

                // å¯åŠ¨å€’è®¡æ—¶
                startCountdown();

                console.log('æ•°æ®åŠ è½½å®Œæˆ', state);

            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }

		// ==================== UIæ›´æ–° ====================
		function updateUI() {
			// åœ£æ®¿æ¦‚å†µ
			document.getElementById('totalStaked').textContent = formatNumber(state.totalStaked, 8) + ' VDS';
			document.getElementById('totalDistributed').textContent = formatNumber(state.totalDistributed, 6) + ' VID';
			// åˆ é™¤ï¼šä¸å†æ˜¾ç¤ºé‡‘åº“å¾…åˆ†çº¢é¢
			document.getElementById('contractBalance').textContent = formatNumber(state.contractBal, 6) + ' VID';
			document.getElementById('accRewardPerShare').textContent = formatNumber(state.accRewardPerShare, 6) + ' VID';
			document.getElementById('estimatedNextDividend').textContent = formatNumber(state.estimatedNextDividend, 6) + ' VID';

			// é‡‘åº“
			document.getElementById('purseBalanceMain').textContent = formatNumber(state.purseBal, 6);

			// è¿›åº¦æ¡
			const totalStakedVDS = state.totalStaked / 1e8;
			const progressPercent = Math.min((totalStakedVDS / MIN_STAKE_FOR_DIVIDENDS) * 100, 100);
			document.getElementById('progressAmount').textContent = formatNumber(state.totalStaked, 8);
			document.getElementById('progressFill').style.width = progressPercent + '%';
			if (progressPercent >= 100) {
				document.getElementById('progressFill').classList.add('completed');
			}

			// æˆ‘çš„ä¿¡ä»°
			document.getElementById('myStaked').textContent = formatNumber(state.stakedAmount, 8) + ' VDS';
			document.getElementById('pendingReward').textContent = formatNumber(state.pendingRewardAmount, 6) + ' VID';
			document.getElementById('totalClaimed').textContent = formatNumber(state.totalRewardDistributed, 6) + ' VID';
			document.getElementById('estimatedReward').textContent = formatNumber(state.estimateVIDReward, 6) + ' VID';
			
			// æ–°å¢ï¼šåˆ†çº¢åº”æ‰£ç¨
			document.getElementById('dividendTax').textContent = formatNumber(state.dividendTax, 8) + ' VDS';

			// æ›´æ–°é¢†å–ç¦æŠ¥æŒ‰é’®çŠ¶æ€
			updateClaimButtonState();

			// VDSä½™é¢
			document.getElementById('vdsBalance').textContent = formatNumber(state.vdsBalance, 8);

			// è§£æŠ¼ç®¡ç†
			// è®¡ç®—ç¨åå¯è§£æŠ¼é‡‘é¢å¹¶ä¿å­˜åˆ°state
			const stakedAmount = state.stakedAmount;
			const taxAmount = state.dividendTax;
			state.availableForUnstake = Math.max(0, stakedAmount - taxAmount);
			
			const currentStakedElement = document.getElementById('currentStaked');
			if (taxAmount > 0) {
				currentStakedElement.innerHTML = `
					<div>${formatNumber(state.availableForUnstake, 8)} VDS</div>
					<div style="font-size: 12px; color: #fbbf24; margin-top: 2px;">
						(è´¨æŠ¼: ${formatNumber(stakedAmount, 8)} VDSï¼Œåˆ†çº¢ç¨: ${formatNumber(taxAmount, 8)} VDS)
					</div>
				`;
			} else {
				currentStakedElement.innerHTML = `
					<div>${formatNumber(state.availableForUnstake, 8)} VDS</div>
				`;
			}
			
			document.getElementById('pendingUnstakeAmount').textContent = formatNumber(state.pendingUnstakeAmount, 8) + ' VDS';

			// è§£é”æ—¶é—´
			if (state.pendingUnstakeAmount > 0 && state.unlockTime > 0) {
				document.getElementById('unlockTime').textContent = formatUnlockTime(state.unlockTime);
			} else {
				document.getElementById('unlockTime').textContent = '';
			}

			// æ›´æ–°è§£æŠ¼ç›¸å…³æŒ‰é’®çŠ¶æ€ï¼ˆä½¿ç”¨ç¨åé‡‘é¢ï¼‰
			updateUnstakeButtonsState();

			// è´¨æŠ¼æŒ‰é’®çŠ¶æ€
			updateStakeButtonState();

			// åˆ†çº¢æŒ‰é’®çŠ¶æ€
			updateDistributeButtonState();
		}

        // ==================== æŒ‰é’®çŠ¶æ€æ›´æ–°å‡½æ•° ====================

        // æ›´æ–°é¢†å–ç¦æŠ¥æŒ‰é’®çŠ¶æ€çš„å‡½æ•°
        function updateClaimButtonState() {
            const claimBtn = document.getElementById('claimBtn');
            
            if (!state.connected) {
                // æœªè¿æ¥é’±åŒ…
                claimBtn.className = 'temple-btn btn-disabled';
                claimBtn.disabled = true;
                claimBtn.innerHTML = '<span>è¯·å…ˆè¿æ¥é’±åŒ…</span>';
            } else if (state.pendingRewardAmount <= 0) {
                // å¾…é¢†ç¦æŠ¥ä¸º0
                claimBtn.className = 'temple-btn btn-disabled';
                claimBtn.disabled = true;
                claimBtn.innerHTML = '<span>æš‚æ— å¯é¢†ç¦æŠ¥</span>';
            } else {
                // å¯ä»¥é¢†å–
                claimBtn.className = 'temple-btn btn-primary';
                claimBtn.disabled = false;
                claimBtn.innerHTML = '<span>é¢†å–ç¦æŠ¥</span>';
            }
        }

		// ==================== æ›´æ–°è§£æŠ¼ç›¸å…³æŒ‰é’®çŠ¶æ€çš„å‡½æ•° ====================
		function updateUnstakeButtonsState() {
			const unstakeBtn = document.getElementById('unstakeBtn');
			const cancelUnstakeBtn = document.getElementById('cancelUnstakeBtn');
			const withdrawBtn = document.getElementById('withdrawBtn');
			const now = Math.floor(Date.now() / 1000);
			
			// 1. å‘èµ·è§£æŠ¼æŒ‰é’®
			if (!state.connected) {
				unstakeBtn.className = 'temple-btn btn-disabled';
				unstakeBtn.disabled = true;
				unstakeBtn.innerHTML = '<span>è¯·å…ˆè¿æ¥é’±åŒ…</span>';
			} else if (state.availableForUnstake <= 0) {
				// ç¨åå¯è§£æŠ¼é‡‘é¢ä¸º0
				unstakeBtn.className = 'temple-btn btn-disabled';
				unstakeBtn.disabled = true;
				unstakeBtn.innerHTML = '<span>æ— å¯è§£æŠ¼</span>';
			} else {
				unstakeBtn.className = 'temple-btn btn-primary';
				unstakeBtn.disabled = false;
				unstakeBtn.innerHTML = '<span>å‘èµ·è§£æŠ¼</span>';
			}
			
			// 2. å–æ¶ˆè§£æŠ¼æŒ‰é’®
			if (!state.connected) {
				cancelUnstakeBtn.className = 'temple-btn btn-disabled';
				cancelUnstakeBtn.disabled = true;
				cancelUnstakeBtn.innerHTML = '<span>è¯·å…ˆè¿æ¥é’±åŒ…</span>';
			} else if (state.pendingUnstakeAmount <= 0) {
				// è§£æŠ¼ç­‰å¾…ä¸º0
				cancelUnstakeBtn.className = 'temple-btn btn-disabled';
				cancelUnstakeBtn.disabled = true;
				cancelUnstakeBtn.innerHTML = '<span>æ— è§£æŠ¼å¯å–æ¶ˆ</span>';
			} else {
				cancelUnstakeBtn.className = 'temple-btn btn-secondary';
				cancelUnstakeBtn.disabled = false;
				cancelUnstakeBtn.innerHTML = '<span>å–æ¶ˆè§£æŠ¼</span>';
			}
			
			// 3. æå–ä»£å¸æŒ‰é’®
			if (!state.connected) {
				withdrawBtn.className = 'temple-btn btn-disabled';
				withdrawBtn.disabled = true;
				withdrawBtn.innerHTML = '<span>è¯·å…ˆè¿æ¥é’±åŒ…</span>';
			} else if (state.pendingUnstakeAmount <= 0) {
				// è§£æŠ¼ç­‰å¾…ä¸º0
				withdrawBtn.className = 'temple-btn btn-disabled';
				withdrawBtn.disabled = true;
				withdrawBtn.innerHTML = '<span>æ— å¯æå–</span>';
			} else if (now < state.unlockTime) {
				// è§£æŠ¼ç­‰å¾…>0ä½†è§£é”æ—¶é—´æœªåˆ°
				withdrawBtn.className = 'temple-btn btn-disabled';
				withdrawBtn.disabled = true;
				withdrawBtn.innerHTML = '<span>ç­‰å¾…è§£é”</span>';
			} else {
				withdrawBtn.className = 'temple-btn btn-secondary';
				withdrawBtn.disabled = false;
				withdrawBtn.innerHTML = '<span>æå–ä»£å¸</span>';
			}
		}

        function updateStakeButtonState() {
            const btn = document.getElementById('stakeBtn');
            const btnText = document.getElementById('stakeBtnText');
            
            if (!state.connected) {
                btn.className = 'temple-btn btn-disabled';
                btnText.textContent = 'è¯·å…ˆè¿æ¥é’±åŒ…';
                btn.disabled = true;
            } else if (state.isApproved) {
                btn.className = 'temple-btn btn-primary';
                btnText.textContent = 'è´¨æŠ¼ VDS';
                btn.disabled = false;
            } else {
                btn.className = 'temple-btn btn-primary';
                btnText.textContent = 'æˆæƒ VDS';
                btn.disabled = false;
            }
        }

        function updateDistributeButtonState() {
            const btn = document.getElementById('distributeBtn');
            const now = Math.floor(Date.now() / 1000);
            const canDistribute = now >= state.nextDistributionTime && 
                                  state.totalStaked >= MIN_STAKE_FOR_DIVIDENDS * 1e8 &&
                                  state.purseBal > 0;
            
            if (canDistribute) {
                btn.className = 'temple-btn btn-primary';
                btn.disabled = false;
            } else {
                btn.className = 'temple-btn btn-disabled';
                btn.disabled = true;
            }
        }

		// ==================== å®šæ—¶å™¨æ›´æ–° ====================
		function startCountdown() {
			if (countdownInterval) clearInterval(countdownInterval);
			
			countdownInterval = setInterval(() => {
				const now = Math.floor(Date.now() / 1000);
				const remaining = state.nextDistributionTime - now;
				document.getElementById('nextDistribution').textContent = formatCountdown(remaining);
				updateDistributeButtonState();
				
				// å®æ—¶æ›´æ–°è§£æŠ¼æŒ‰é’®çŠ¶æ€ï¼ˆç‰¹åˆ«æ˜¯æå–æŒ‰é’®çš„æ—¶é—´æ£€æŸ¥ï¼‰
				updateUnstakeButtonsState();

				// æ›´æ–°è§£é”æ—¶é—´
				if (state.pendingUnstakeAmount > 0 && state.unlockTime > 0) {
					document.getElementById('unlockTime').textContent = formatUnlockTime(state.unlockTime);
				}
			}, 1000);
		}

        // ==================== äº¤äº’æ“ä½œ ====================
        async function handleApproveOrStake() {
            if (!state.connected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }

            try {
                if (!state.isApproved) {
                    // æˆæƒ
                    showLoading('æˆæƒä¸­...');
                    const maxApproval = '115792089237316195423570985008687907853269984665640564039457584007913129639935';
                    await vdsContract.methods.approve(CONFIG.CONTRACTS.Temple, maxApproval)
                        .send({ 
							from: web3Manager.account,
							gasPrice: await web3Manager.getOptimizedGasPrice()
						});
                    hideLoading();
                    showToast('æˆæƒæˆåŠŸï¼', 'success');
                    state.isApproved = true;
                    updateStakeButtonState();
                } else {
                    // è´¨æŠ¼
                    const amount = parseFloat(document.getElementById('stakeAmount').value);
                    if (!amount || amount < MIN_STAKE_AMOUNT) {
                        showToast(`æœ€å°è´¨æŠ¼æ•°é‡ä¸º ${MIN_STAKE_AMOUNT} VDS`, 'error');
                        return;
                    }
                    if (amount > state.vdsBalance / 1e8) {
                        showToast('ä½™é¢ä¸è¶³', 'error');
                        return;
                    }

                    showLoading('è´¨æŠ¼ä¸­...');
                    const amountWei = BigInt(Math.floor(amount * 1e8)).toString();
                    await templeContract.methods.stake(amountWei).send({ 
						from: web3Manager.account,
						gasPrice: await web3Manager.getOptimizedGasPrice()
					 });
                    hideLoading();
                    showToast('è´¨æŠ¼æˆåŠŸï¼', 'success');
                    document.getElementById('stakeAmount').value = '';
                    setTimeout(() => loadData(), 2000);
                }
            } catch (error) {
                hideLoading();
                console.error('æ“ä½œå¤±è´¥:', error);
                if (error.code === 4001) {
                    showToast('ç”¨æˆ·å–æ¶ˆäº¤æ˜“', 'error');
                } else {
                    showToast('æ“ä½œå¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            }
        }

		// ==================== å‘èµ·è§£æŠ¼å‡½æ•° ====================
		async function handleRequestUnstake() {
			// æŒ‰é’®çŠ¶æ€éªŒè¯
			const unstakeBtn = document.getElementById('unstakeBtn');
			if (unstakeBtn.disabled || unstakeBtn.classList.contains('btn-disabled')) {
				return;
			}
			
			if (!state.connected) {
				showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
				return;
			}

			const amount = parseFloat(document.getElementById('unstakeAmount').value);
			if (!amount || amount < MIN_STAKE_AMOUNT) {
				showToast(`æœ€å°è§£æŠ¼æ•°é‡ä¸º ${MIN_STAKE_AMOUNT} VDS`, 'error');
				return;
			}
			
			// ä½¿ç”¨stateä¸­çš„ç¨åå¯è§£æŠ¼é‡‘é¢
			const availableForUnstake = state.availableForUnstake / 1e8;
			
			if (amount > availableForUnstake) {
				showToast(`è§£æŠ¼æ•°é‡è¶…è¿‡å…è®¸è§£æŠ¼é‡ï¼ˆç¨åï¼‰`, 'error');
				return;
			}

			try {
				showLoading('å‘èµ·è§£æŠ¼ä¸­...');
				const amountWei = BigInt(Math.floor(amount * 1e8)).toString();
				await templeContract.methods.requestUnstake(amountWei).send({ 
					from: web3Manager.account,
					gasPrice: await web3Manager.getOptimizedGasPrice()
				 });
				hideLoading();
				showToast('è§£æŠ¼è¯·æ±‚å·²æäº¤ï¼Œ3å¤©åå¯æå–', 'success');
				document.getElementById('unstakeAmount').value = '';
				setTimeout(() => loadData(), 2000);
			} catch (error) {
				hideLoading();
				console.error('è§£æŠ¼å¤±è´¥:', error);
				if (error.code === 4001) {
					showToast('ç”¨æˆ·å–æ¶ˆäº¤æ˜“', 'error');
				} else {
					showToast('è§£æŠ¼å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
				}
			}
		}

        async function handleCancelUnstake() {
            // æŒ‰é’®çŠ¶æ€éªŒè¯
            const cancelBtn = document.getElementById('cancelUnstakeBtn');
            if (cancelBtn.disabled || cancelBtn.classList.contains('btn-disabled')) {
                return;
            }
            
            if (!state.connected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            if (state.pendingUnstakeAmount <= 0) {
                showToast('æ²¡æœ‰å¾…å–æ¶ˆçš„è§£æŠ¼', 'error');
                return;
            }

            try {
                showLoading('å–æ¶ˆè§£æŠ¼ä¸­...');
                await templeContract.methods.cancelUnstake().send({ 
					from: web3Manager.account,
					gasPrice: await web3Manager.getOptimizedGasPrice()
				});
                hideLoading();
                showToast('å·²å–æ¶ˆè§£æŠ¼ï¼Œä»£å¸å·²æ¢å¤è´¨æŠ¼', 'success');
                setTimeout(() => loadData(), 2000);
            } catch (error) {
                hideLoading();
                console.error('å–æ¶ˆè§£æŠ¼å¤±è´¥:', error);
                if (error.code === 4001) {
                    showToast('ç”¨æˆ·å–æ¶ˆäº¤æ˜“', 'error');
                } else {
                    showToast('å–æ¶ˆè§£æŠ¼å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            }
        }

        async function handleWithdraw() {
            // æŒ‰é’®çŠ¶æ€éªŒè¯
            const withdrawBtn = document.getElementById('withdrawBtn');
            if (withdrawBtn.disabled || withdrawBtn.classList.contains('btn-disabled')) {
                return;
            }
            
            if (!state.connected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            if (state.pendingUnstakeAmount <= 0) {
                showToast('æ²¡æœ‰å¯æå–çš„ä»£å¸', 'error');
                return;
            }
            const now = Math.floor(Date.now() / 1000);
            if (now < state.unlockTime) {
                showToast('è§£é”æ—¶é—´æœªåˆ°ï¼Œè¯·è€å¿ƒç­‰å¾…', 'error');
                return;
            }

            try {
                showLoading('æå–ä¸­...');
                await templeContract.methods.withdraw().send({ 
					from: web3Manager.account,
					gasPrice: await web3Manager.getOptimizedGasPrice()
				});
                hideLoading();
                showToast('æå–æˆåŠŸï¼', 'success');
                setTimeout(() => loadData(), 2000);
            } catch (error) {
                hideLoading();
                console.error('æå–å¤±è´¥:', error);
                if (error.code === 4001) {
                    showToast('ç”¨æˆ·å–æ¶ˆäº¤æ˜“', 'error');
                } else {
                    showToast('æå–å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            }
        }

        async function handleClaimReward() {
            // æŒ‰é’®çŠ¶æ€éªŒè¯
            const claimBtn = document.getElementById('claimBtn');
            if (claimBtn.disabled || claimBtn.classList.contains('btn-disabled')) {
                return;
            }
            
            if (!state.connected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            if (state.pendingRewardAmount <= 0) {
                showToast('æ²¡æœ‰å¯é¢†å–çš„ç¦æŠ¥', 'error');
                return;
            }

            try {
                showLoading('é¢†å–ä¸­...');
                await templeContract.methods.claimReward().send({ 
					from: web3Manager.account,
					gasPrice: await web3Manager.getOptimizedGasPrice()
				});
                hideLoading();
                showToast('ç¦æŠ¥é¢†å–æˆåŠŸï¼', 'success');
                setTimeout(() => loadData(), 2000);
            } catch (error) {
                hideLoading();
                console.error('é¢†å–å¤±è´¥:', error);
                if (error.code === 4001) {
                    showToast('ç”¨æˆ·å–æ¶ˆäº¤æ˜“', 'error');
                } else {
                    showToast('é¢†å–å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            }
        }

        async function handleDistribute() {
            const btn = document.getElementById('distributeBtn');
            if (btn.disabled || btn.classList.contains('btn-disabled')) {
                return;
            }
            
            const now = Math.floor(Date.now() / 1000);
            if (now < state.nextDistributionTime) {
                showToast('è¿˜æœªåˆ°åˆ†çº¢æ—¶é—´', 'error');
                return;
            }
            if (state.totalStaked < MIN_STAKE_FOR_DIVIDENDS * 1e8) {
                showToast('å…¨ç½‘è´¨æŠ¼é‡ä¸è¶³8888 VDS', 'error');
                return;
            }
            if (state.purseBal <= 0) {
                showToast('é‡‘åº“ä½™é¢ä¸º0ï¼Œæ— æ³•åˆ†çº¢', 'error');
                return;
            }

            try {
                showLoading('å¼€å¯é‡‘åº“ä¸­...');
                await templeContract.methods.distributeRewards().send({ 
					from: web3Manager.account,
					gasPrice: await web3Manager.getOptimizedGasPrice()
				});
                hideLoading();
                showToast('é‡‘åº“åˆ†çº¢æˆåŠŸï¼', 'success');
                setTimeout(() => loadData(), 2000);
            } catch (error) {
                hideLoading();
                console.error('åˆ†çº¢å¤±è´¥:', error);
                if (error.code === 4001) {
                    showToast('ç”¨æˆ·å–æ¶ˆäº¤æ˜“', 'error');
                } else {
                    showToast('åˆ†çº¢å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            }
        }

        // ==================== åˆå§‹åŒ– ====================
        window.addEventListener('load', () => {
            initParticles();
            initKeyboardHandler();
            setTimeout(loadData, 100);
        });
    </script>
</body>
</html>
