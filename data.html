<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title data-i18n="data.pageTitle">æ•°æ®ä¸­å¿ƒ</title>
	<link rel="icon" href="./favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
		body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; background: #0a0520; color: #fff; overflow-x: hidden; }
		
		/* ========== èƒŒæ™¯ä¼˜åŒ–ï¼šæé«˜å¯¹æ¯”åº¦ ========== */
		.bg-gradient { 
			position: fixed; 
			top: 0; 
			left: 0; 
			right: 0; 
			bottom: 0; 
			background: linear-gradient(135deg, #0a0520 0%, #14092f 50%, #23104b 100%); 
			z-index: -2; 
		}
		.bg-stars { 
			position: fixed; 
			top: 0; 
			left: 0; 
			right: 0; 
			bottom: 0; 
			background-image: radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.2), transparent), 
							 radial-gradient(2px 2px at 60% 70%, rgba(168,85,247,0.25), transparent), 
							 radial-gradient(1px 1px at 50% 50%, rgba(255,255,255,0.15), transparent);
			background-size: 200% 200%; 
			opacity: 0.25;
			animation: twinkle 12s ease-in-out infinite; 
			z-index: -1; 
		}
		@keyframes twinkle { 0%, 100% { opacity: 0.25; } 50% { opacity: 0.15; } }
		
		/* ========== é¡¶éƒ¨æ  ========== */
		.top-bar { 
			display: flex; 
			justify-content: space-between; 
			align-items: center; 
			padding: 12px 20px; 
			background: rgba(26, 11, 61, 0.6); 
			backdrop-filter: blur(20px); 
			border-bottom: 1px solid rgba(168, 85, 247, 0.2); 
		}
		.nav-left { display: flex; align-items: center; gap: 12px; }
		.back-btn { 
			width: 36px; 
			height: 36px; 
			border-radius: 12px; 
			background: rgba(168, 85, 247, 0.15); 
			border: 1px solid rgba(168, 85, 247, 0.3); 
			color: #a855f7; 
			font-size: 18px; 
			display: flex; 
			align-items: center; 
			justify-content: center; 
			cursor: pointer; 
			transition: all 0.3s; 
		}
		.back-btn:active { transform: scale(0.95); }
		.page-title { 
			font-size: 18px; 
			font-weight: 700; 
			background: linear-gradient(135deg, #fb923c 0%, #f59e0b 100%); 
			-webkit-background-clip: text; 
			-webkit-text-fill-color: transparent; 
		}
		.refresh-btn { 
			padding: 8px 16px; 
			background: rgba(168, 85, 247, 0.15); 
			border: 1px solid rgba(168, 85, 247, 0.3); 
			border-radius: 12px; 
			color: #a855f7; 
			font-size: 14px; 
			font-weight: 600; 
			cursor: pointer; 
			transition: all 0.3s; 
			display: flex; 
			align-items: center; 
			gap: 6px; 
		}
		.refresh-btn:active { transform: scale(0.95); }
		.refresh-icon.spinning { animation: spin 0.5s linear; }
		@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
		
		/* ========== å®¹å™¨å’Œæ•°æ®å¡ç‰‡ ========== */
		.container { padding: 20px; padding-bottom: 100px; }
		.data-card { 
			background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(217, 70, 239, 0.15) 100%); 
			backdrop-filter: blur(20px); 
			border: 1px solid rgba(168, 85, 247, 0.3); 
			border-radius: 24px; 
			padding: 20px; 
			margin-bottom: 20px; 
			box-shadow: 0 10px 40px rgba(168, 85, 247, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1); 
			position: relative; 
			overflow: hidden; 
		}
		.data-card::before { 
			content: ''; 
			position: absolute; 
			top: -50%; 
			left: -50%; 
			width: 200%; 
			height: 200%; 
			background: radial-gradient(circle, rgba(168, 85, 247, 0.1) 0%, transparent 70%); 
			animation: pulse 4s ease-in-out infinite; 
		}
		@keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.1); opacity: 0.3; } }
		.card-content { position: relative; z-index: 1; }
		
		/* ========== å­—ä½“ä¼˜åŒ–ï¼šæŒ‰æ–¹æ¡ˆC+æ‰§è¡Œ ========== */
		.section-title { 
			font-size: 18px; 
			font-weight: 700; 
			color: #fff; 
			display: flex; 
			align-items: center; 
			gap: 8px; 
			margin-bottom: 18px; 
		}
		
		/* å¾½ç« ï¼š11px â†’ 13px (+2px) */
		.section-badge { 
			padding: 4px 12px; 
			border-radius: 12px; 
			font-size: 13px; /* ä¼˜åŒ–ï¼š11px â†’ 13px */
			font-weight: 600; 
			background: linear-gradient(135deg, rgba(168, 85, 247, 0.3) 0%, rgba(217, 70, 239, 0.3) 100%); 
			border: 1px solid rgba(168, 85, 247, 0.5); 
		}
		
		.stat-row { 
			display: flex; 
			justify-content: space-between; 
			align-items: center; 
			padding: 12px 0; 
			border-bottom: 1px solid rgba(255, 255, 255, 0.05); 
		}
		.stat-row:last-child { border-bottom: none; }
		
		/* æ•°æ®æ ‡ç­¾ï¼š14px â†’ 15px (+1px) */
		.stat-label { 
			font-size: 15px; /* ä¼˜åŒ–ï¼š14px â†’ 15px */
			color: rgba(255, 255, 255, 0.8); /* æé«˜å¯¹æ¯”åº¦ï¼š0.6 â†’ 0.8 */
			font-weight: 500; 
		}
		
		/* æ•°æ®å€¼ï¼š15px â†’ 16px (+1px) */
		.stat-value { 
			font-size: 16px; /* ä¼˜åŒ–ï¼š15px â†’ 16px */
			font-weight: 700; 
			color: #fff; 
		}
		
		.num-integer { font-weight: 700; }
		.num-decimal { 
			font-size: 13px; 
			font-weight: 400; 
			opacity: 0.9; 
		}
		.stat-orange { background: linear-gradient(135deg, #fb923c 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
		.stat-orange .num-decimal { background: linear-gradient(135deg, #fb923c 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; opacity: 0.8; }
		.stat-purple { color: #a855f7; }
		.stat-purple .num-decimal { color: #a855f7; opacity: 0.8; }
		.stat-green { color: #10b981; }
		.divider { 
			height: 1px; 
			background: rgba(255, 255, 255, 0.05); 
			margin: 16px 0; 
		}
		
		/* ========== æ’åç½‘æ ¼ä¼˜åŒ– ========== */
		.rank-grid { 
			display: grid; 
			grid-template-columns: repeat(3, 1fr); 
			gap: 12px; 
			margin-bottom: 16px; 
		}
		.rank-box { 
			background: rgba(255, 255, 255, 0.03); 
			border: 1px solid rgba(255, 255, 255, 0.08); 
			border-radius: 14px; 
			padding: 12px; 
			text-align: center; 
		}
		
		/* æ’åæ ‡ç­¾ï¼š11px â†’ 14px (+3px) */
		.rank-box-label { 
			font-size: 14px; /* ä¼˜åŒ–ï¼š11px â†’ 14px */
			color: rgba(255, 255, 255, 0.8); /* æé«˜å¯¹æ¯”åº¦ */
			margin-bottom: 6px; 
			font-weight: 600; /* åŠ ç²—æé«˜å¯è¯»æ€§ */
		}
		
		/* æ’åå€¼ï¼š20px â†’ 21px (+1px) */
		.rank-box-value { 
			font-size: 21px; /* ä¼˜åŒ–ï¼š20px â†’ 21px */
			font-weight: 800; 
			background: linear-gradient(135deg, #fb923c 0%, #f59e0b 100%); 
			-webkit-background-clip: text; 
			-webkit-text-fill-color: transparent; 
		}
		
		/* ========== å¾½ç« ä¼˜åŒ– ========== */
		.layer-badge { 
			display: inline-block; 
			padding: 4px 14px; 
			border-radius: 20px; 
			font-size: 13px; 
			font-weight: 700; 
			background: linear-gradient(135deg, #a855f7 0%, #d946ef 100%); 
			color: #fff; 
		}
		.badge-layer1 { background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #000; }
		.badge-layer2 { background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%); color: #000; }
		.badge-layer3 { background: linear-gradient(135deg, #cd7f32 0%, #e6a859 100%); color: #000; }
		.badge-layer4 { background: linear-gradient(135deg, #a855f7 0%, #c084fc 100%); color: #fff; }
		.badge-layer5 { background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); color: #fff; }
		.badge-layer6 { background: linear-gradient(135deg, #10b981 0%, #34d399 100%); color: #fff; }
		
		/* ========== å±‚å¡ç‰‡ä¼˜åŒ– ========== */
		.layer-card { 
			background: rgba(255, 255, 255, 0.03); 
			border: 1px solid rgba(255, 255, 255, 0.08); 
			border-radius: 16px; 
			padding: 16px; 
			margin-bottom: 12px; 
		}
		.layer-header { 
			display: flex; 
			justify-content: space-between; 
			align-items: center; 
			margin-bottom: 12px; 
		}
		.layer-name { 
			font-size: 16px; 
			font-weight: 700; 
			color: #fff; 
		}
		
		/* çŠ¶æ€å¾½ç« ï¼š11px â†’ 13px (+2px) */
		.layer-status-badge { 
			display: flex; 
			align-items: center; 
			gap: 6px; 
			font-size: 13px; /* ä¼˜åŒ–ï¼š11px â†’ 13px */
			font-weight: 600; 
		}
		.layer-status-text { 
			color: rgba(255, 255, 255, 0.7); 
		}
		.layer-threshold { 
			display: flex; 
			justify-content: space-between; 
			align-items: center; 
			padding: 8px 0; 
		}
		.threshold-label { 
			font-size: 13px; 
			color: rgba(255, 255, 255, 0.7); 
			font-weight: 500; 
		}
		.threshold-value { 
			font-size: 16px; 
			font-weight: 700; 
			background: linear-gradient(135deg, #fb923c 0%, #f59e0b 100%); 
			-webkit-background-clip: text; 
			-webkit-text-fill-color: transparent; 
		}
		
		/* ========== Tabåˆ‡æ¢ ========== */
		.tab-group { 
			display: flex; 
			gap: 8px; 
			margin-bottom: 16px; 
		}
		.tab-btn { 
			flex: 1; 
			padding: 10px; 
			background: rgba(255, 255, 255, 0.05); 
			border: 1px solid rgba(255, 255, 255, 0.1); 
			border-radius: 10px; 
			color: rgba(255, 255, 255, 0.6); 
			font-size: 13px; 
			font-weight: 600; 
			cursor: pointer; 
			transition: all 0.3s; 
		}
		.tab-btn.active { 
			background: linear-gradient(135deg, rgba(168, 85, 247, 0.3) 0%, rgba(217, 70, 239, 0.3) 100%); 
			border-color: rgba(168, 85, 247, 0.5); 
			color: #fff; 
		}
		.tab-content { display: none; }
		.tab-content.active { display: block; }
		
		/* ========== æ’ååˆ—è¡¨ ========== */
		.rank-list { max-height: 500px; overflow-y: auto; }
		.rank-item { 
			background: rgba(255, 255, 255, 0.03); 
			border: 1px solid rgba(255, 255, 255, 0.08); 
			border-radius: 12px; 
			padding: 14px; 
			margin-bottom: 8px; 
			display: flex; 
			align-items: center; 
			justify-content: space-between; 
			gap: 12px; 
		}
		.rank-number { 
			width: 36px; 
			height: 36px; 
			border-radius: 50%; 
			background: rgba(168, 85, 247, 0.2); 
			display: flex; 
			align-items: center; 
			justify-content: center; 
			font-size: 14px; 
			font-weight: 700; 
			color: #fff; 
			flex-shrink: 0; 
		}
		.rank-top1 { background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #000; }
		.rank-top2 { background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%); color: #000; }
		.rank-top3 { background: linear-gradient(135deg, #cd7f32 0%, #e6a859 100%); color: #000; }
		.rank-value { 
			font-size: 15px; 
			font-weight: 700; 
			background: linear-gradient(135deg, #fb923c 0%, #f59e0b 100%); 
			-webkit-background-clip: text; 
			-webkit-text-fill-color: transparent; 
		}
		.load-more-btn { 
			width: 100%; 
			padding: 12px; 
			background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(217, 70, 239, 0.2) 100%); 
			border: 1px solid rgba(168, 85, 247, 0.4); 
			border-radius: 12px; 
			color: #a855f7; 
			font-size: 14px; 
			font-weight: 700; 
			cursor: pointer; 
			margin-top: 12px; 
		}
		.empty-state { 
			text-align: center; 
			padding: 40px 20px; 
			color: rgba(255, 255, 255, 0.5); 
		}
		.empty-icon { 
			font-size: 48px; 
			margin-bottom: 12px; 
			opacity: 0.5; 
		}
		.empty-text { 
			font-size: 14px; 
		}
		
		/* ========== åº•éƒ¨å¯¼èˆªï¼šä¿æŒå®Œå…¨åŸæ · ========== */
		.bottom-nav { 
			position: fixed; 
			bottom: 0; 
			left: 0; 
			right: 0; 
			display: flex; 
			justify-content: space-around; 
			padding: 12px 0 20px; /* ä¿æŒåŸæ · */
			background: rgba(26, 11, 61, 0.8); /* ä¿æŒåŸæ · */
			backdrop-filter: blur(20px); 
			border-top: 1px solid rgba(168, 85, 247, 0.2); /* ä¿æŒåŸæ · */
			box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.3); /* ä¿æŒåŸæ · */
			z-index: 1000; 
		}
		.nav-item { 
			display: flex; 
			flex-direction: column; 
			align-items: center; 
			gap: 4px; /* ä¿æŒåŸæ · */
			cursor: pointer; 
			padding: 8px 16px; /* ä¿æŒåŸæ · */
			border-radius: 12px; 
			transition: all 0.3s; 
		}
		.nav-item.active { background: rgba(168, 85, 247, 0.15); }
		.nav-icon { 
			font-size: 24px; /* ä¿æŒåŸæ ·ï¼š24px */
			transition: all 0.3s; 
		}
		.nav-item.active .nav-icon { color: #a855f7; transform: scale(1.1); }
		.nav-item:not(.active) .nav-icon { color: rgba(255, 255, 255, 0.4); }
		.nav-label { 
			font-size: 11px; /* ä¿æŒåŸæ ·ï¼š11px */
			font-weight: 600; 
			transition: all 0.3s; 
		}
		.nav-item.active .nav-label { color: #a855f7; }
		.nav-item:not(.active) .nav-label { color: rgba(255, 255, 255, 0.4); }
	</style>
</head>
<body>
    <!-- ========== ä»¥ä¸‹æ˜¯æ‚¨åŸæœ‰çš„HTMLç»“æ„ï¼Œå®Œå…¨æœªæ”¹åŠ¨ ========== -->
    <div class="bg-gradient"></div>
    <div class="bg-stars"></div>
    <div class="top-bar">
        <div class="nav-left">
            <button class="back-btn" onclick="goBack()">â†</button>
            <div class="page-title">ğŸ“Š <span data-i18n="data.title">æ•°æ®ä¸­å¿ƒ</span></div>
        </div>
        <button class="refresh-btn" onclick="refreshData()">
            <span class="refresh-icon" id="refreshIcon">ğŸ”„</span>
            <span data-i18n="common.refresh">åˆ·æ–°</span>
        </button>
    </div>
    <div class="container">
        <div class="data-card">
            <div class="card-content">
                <div class="section-title"><span>ğŸŒ</span><span data-i18n="data.globalStats">å…¨ç½‘ç»Ÿè®¡</span></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.resonanceUsers">å…±æŒ¯äººæ•°</div><div class="stat-value stat-orange" id="globalUsers">0</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.totalCommunities">ç¤¾åŒºæ€»æ•°</div><div class="stat-value stat-purple" id="globalCommunities">0</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.totalMintedVollar">å…¨ç½‘é“¸é€  Vollar</div><div class="stat-value stat-orange" id="globalMinted">0</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.totalVIDResonance">å…¨ç½‘å…±æŒ¯ VID</div><div class="stat-value" id="globalVID">0</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.totalUSDTResonance">å…¨ç½‘å…±æŒ¯ USDT</div><div class="stat-value" id="globalUSDT">0</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.transferTax">å½“å‰è½¬è´¦ç¨ç‡</div><div class="stat-value" id="tokenTax">0%</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.interestRate">å½“å‰ç”Ÿæ¯åˆ©ç‡</div><div class="stat-value" id="interestRate">0%</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.contractRuntime">åˆçº¦è¿è¡Œæ—¶é—´</div><div class="stat-value" id="contractRuntime">0å¤© 0æ—¶ 0åˆ† 0ç§’</div></div>
            </div>
        </div>
        <div class="data-card">
            <div class="card-content">
                <div class="section-title"><span>ğŸ“ˆ</span><span data-i18n="data.myData">æˆ‘çš„æ•°æ®</span></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.totalMinted">æ€»é“¸é€  Vollar</div><div class="stat-value stat-orange" id="totalMinted">0</div></div>
                <div class="stat-row"><div class="stat-label">â”œâ”€ <span data-i18n="data.fromVID">VID å…±æŒ¯</span></div><div class="stat-value" id="vollarFromVID">0</div></div>
                <div class="stat-row"><div class="stat-label">â”œâ”€ <span data-i18n="data.fromUSDT">USDT å…±æŒ¯</span></div><div class="stat-value" id="vollarFromUSDT">0</div></div>
                <div class="stat-row"><div class="stat-label">â”œâ”€ <span data-i18n="data.fromInterest">æŒå¸ç”Ÿæ¯</span></div><div class="stat-value" id="vollarFromInterest">0</div></div>
                <div class="stat-row"><div class="stat-label">â””â”€ <span data-i18n="data.communitySubsidy">ç¤¾åŒºè¡¥è´´</span></div><div class="stat-value stat-purple" id="communitySubsidy">0</div></div>
                <div class="divider"></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.vidResonanceTotal">å…±æŒ¯ VID æ€»é¢</div><div class="stat-value" id="vidResonance">0</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.usdtResonanceTotal">å…±æŒ¯ USDT æ€»é¢</div><div class="stat-value" id="usdtResonance">0</div></div>
                <div class="divider"></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.refRewards">æ™®é€šæ¨èå¥–åŠ±</div><div class="stat-value stat-orange" id="refRewards">0</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.communityRewards">ç¤¾åŒºæ¨èå¥–åŠ±</div><div class="stat-value stat-purple" id="communityRewards">0</div></div>
                <div class="divider"></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.burnedVollar">å…‘æ¢é”€æ¯ Vollar</div><div class="stat-value stat-orange" id="burnedVollar">0</div></div>
                <div class="stat-row"><div class="stat-label">â”œâ”€ <span data-i18n="data.exchangedBNB">å…‘æ¢ BNB</span></div><div class="stat-value" id="exchangedBNB">0</div></div>
                <div class="stat-row"><div class="stat-label">â”œâ”€ <span data-i18n="data.exchangedUSDT">å…‘æ¢ USDT</span></div><div class="stat-value" id="exchangedUSDT">0</div></div>
                <div class="stat-row"><div class="stat-label">â””â”€ <span data-i18n="data.exchangedVID">å…‘æ¢ VID</span></div><div class="stat-value" id="exchangedVID">0</div></div>
                <div class="divider"></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.usdtForVID">USDT å…‘æ¢ VID</div><div class="stat-value" id="usdtForVID">0</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.getTotalVID">è·å¾— VID</div><div class="stat-value" id="getTotalVID">0</div></div>
            </div>
        </div>
        <div class="data-card">
            <div class="card-content">
                <div class="section-title"><span>ğŸ‘¥</span><span data-i18n="data.myTeam">æˆ‘çš„å›¢é˜Ÿ</span><span class="section-badge" id="teamBadge">0/0 ç”Ÿæ¯</span></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.myReferrer">æˆ‘çš„æ¨èäºº</div><div class="stat-value" id="myReferrer" style="font-size: 13px; font-family: 'Courier New', monospace;">-</div></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.referrerCommunity">æ¨èç¤¾åŒº</div><div class="stat-value" id="myReferrerCommunity" style="font-size: 13px; font-family: 'Courier New', monospace;">-</div></div>
                <div class="divider"></div>
                <div class="stat-row"><div class="stat-label" data-i18n="data.firstLevelCount">ä¸€çº§å›¢é˜Ÿäººæ•°</div><div class="stat-value stat-orange" id="totalFirstLevel">0</div></div>
                <div class="stat-row"><div class="stat-label">â”œâ”€ <span data-i18n="data.interestEnabled">å·²å¼€å¯ç”Ÿæ¯</span></div><div class="stat-value stat-green" id="activeInterest">0</div></div>
                <div class="stat-row"><div class="stat-label">â””â”€ <span data-i18n="data.interestDisabled">æœªå¼€å¯ç”Ÿæ¯</span></div><div class="stat-value" id="inactiveInterest">0</div></div>
            </div>
        </div>
        <div class="data-card" id="rankingCard">
            <div class="card-content">
                <div class="section-title"><span>ğŸ†</span><span data-i18n="data.myCommunityRank">æˆ‘çš„ç¤¾åŒºæ’å</span><span class="section-badge" id="rankingBadge">åŠ è½½ä¸­...</span></div>
                <div id="rankingStateA" style="display: none;">
                    <div style="text-align: center; padding: 20px 0;">
                        <div style="font-size: 14px; color: rgba(255, 255, 255, 0.6); margin-bottom: 16px;">ğŸ’¡ <span data-i18n="data.communityCondition">æˆä¸ºç¤¾åŒºæ¡ä»¶</span></div>
                        <div style="font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 4px;" data-i18n="data.singleResonance">å•æ¬¡å…±æŒ¯é“¸é€ è·å¾—</div>
                        <div style="font-size: 24px; font-weight: 800; margin-bottom: 20px;"><span class="stat-orange" id="communityFee">0</span> Vollar</div>
                        <div style="font-size: 13px; color: rgba(255, 255, 255, 0.5); line-height: 1.6;" data-i18n="data.communityTip">ä½¿ç”¨VIDå…±æŒ¯ä¸€æ¬¡æ€§é“¸é€ è¶³å¤Ÿçš„Vollarå³å¯æˆä¸ºç¤¾åŒº</div>
                    </div>
                </div>
                <div id="rankingStateB" style="display: none;">
                    <div class="stat-row"><div class="stat-label" data-i18n="data.currentPerformance">å½“å‰ä¸šç»©</div><div class="stat-value stat-orange" id="myPerformanceB">0</div></div>
                    <div class="stat-row"><div class="stat-label" data-i18n="data.rankThreshold">å…¥æ¦œé—¨æ§›</div><div class="stat-value stat-purple" id="top1000Threshold">0</div></div>
                    <div class="stat-row"><div class="stat-label" data-i18n="data.gapToRank">è·ç¦»å…¥æ¦œ</div><div class="stat-value" id="gapToRanked">0</div></div>
                    <div style="margin-top: 16px; padding: 12px; background: rgba(251, 191, 36, 0.1); border-radius: 12px; border: 1px solid rgba(251, 191, 36, 0.2);"><div style="font-size: 13px; color: rgba(251, 191, 36, 0.9); text-align: center;" data-i18n="data.rankTip">ğŸ’¡ ç»§ç»­å…±æŒ¯æå‡ä¸šç»©å¯å…¥æ¦œå‰1000å</div></div>
                </div>
                <div id="rankingStateC" style="display: none;">
                    <div class="rank-grid">
                        <div class="rank-box"><div class="rank-box-label" data-i18n="data.globalRank">å…¨çƒæ’å</div><div class="rank-box-value" id="globalRank">-</div></div>
                        <div class="rank-box"><div class="rank-box-label" data-i18n="data.layerRank">å±‚å†…æ’å</div><div class="rank-box-value" id="layerRank">-</div></div>
                        <div class="rank-box"><div class="rank-box-label" data-i18n="data.exchangeMultiplier">å…‘æ¢å€ç‡</div><div class="rank-box-value" id="exchangeRate">0x</div></div>
                    </div>
                    <div class="stat-row"><div class="stat-label" data-i18n="data.currentLayer">æ‰€åœ¨å±‚çº§</div><div class="stat-value"><span class="layer-badge" id="layerBadge">-</span></div></div>
                    <div class="stat-row"><div class="stat-label" data-i18n="data.currentPerformance">å½“å‰ä¸šç»©</div><div class="stat-value stat-orange" id="myPerformanceC">0</div></div>
                </div>
            </div>
        </div>
        <div class="data-card">
            <div class="card-content">
                <div class="section-title"><span>ğŸ¯</span><span data-i18n="data.communityRankStatus">ç¤¾åŒºæ’åçŠ¶æ€</span><span class="section-badge" id="rankedCount">0/1000</span></div>
                <div id="layersContainer"></div>
            </div>
        </div>
        <div class="data-card">
            <div class="card-content">
                <div class="section-title"><span>ğŸ“Š</span><span data-i18n="data.communityLeaderboard">ç¤¾åŒºæ’è¡Œæ¦œ</span></div>
                <div class="tab-group">
                    <button class="tab-btn active" onclick="switchTab('performance')" data-i18n="data.performanceRank">ä¸šç»©æ’è¡Œ</button>
                    <button class="tab-btn" onclick="switchTab('minting')" data-i18n="data.mintingRank">é“¸é€ å¥–åŠ±</button>
                    <button class="tab-btn" onclick="switchTab('referral')" data-i18n="data.referralRank">æ¨èå¥–åŠ±</button>
                </div>
                <div class="tab-content active" id="performance"><div class="rank-list" id="performanceList"><div class="empty-state"><div class="empty-icon">ğŸ“Š</div><div class="empty-text" data-i18n="common.loading">æ­£åœ¨åŠ è½½...</div></div></div></div>
                <div class="tab-content" id="minting"><div class="rank-list" id="mintingList"><div class="empty-state"><div class="empty-icon">ğŸ’°</div><div class="empty-text" data-i18n="common.loading">æ­£åœ¨åŠ è½½...</div></div></div></div>
                <div class="tab-content" id="referral"><div class="rank-list" id="referralList"><div class="empty-state"><div class="empty-icon">ğŸ</div><div class="empty-text" data-i18n="common.loading">æ­£åœ¨åŠ è½½...</div></div></div></div>
            </div>
        </div>
    </div>
    <div class="bottom-nav">
        <div class="nav-item" onclick="switchPage('home')" data-page="home"><div class="nav-icon">ğŸ </div><div class="nav-label" data-i18n="nav.home">é¦–é¡µ</div></div>
        <div class="nav-item active" onclick="switchPage('stats')" data-page="stats"><div class="nav-icon">ğŸ“Š</div><div class="nav-label" data-i18n="nav.data">æ•°æ®</div></div>
        <div class="nav-item" onclick="switchPage('swap')" data-page="swap"><div class="nav-icon">ğŸ’°</div><div class="nav-label" data-i18n="nav.exchange">å…‘æ¢</div></div>
        <div class="nav-item" onclick="switchPage('temple')" data-page="temple"><div class="nav-icon">ğŸ›ï¸</div><div class="nav-label" data-i18n="nav.temple">åœ£æ®¿</div></div>
    </div>
    <script src="js/config.js"></script>
    <script src="js/web3-manager.js"></script>
    <script>
        // ========== ä»¥ä¸‹æ˜¯æ‚¨åŸæœ‰çš„JavaScriptä»£ç ï¼Œå®Œå…¨æœªæ”¹åŠ¨ ==========
        const PAGE_SIZE = 50;
        const LAYER_NAMES = ['TOP 10', 'TOP 30', 'TOP 100', 'TOP 300', 'TOP 600', 'TOP 1000'];
        const LAYER_CAPACITIES = [10, 20, 70, 200, 300, 400];
        let currentPage = { performance: 0, minting: 0, referral: 0 };
        let leaderboardLoaded = { performance: false, minting: false, referral: false };
        let totalCommunities = 0;
        let runtimeInterval = null;
        let contract = null;

        function formatNumberFull(num, decimals = 6) {
            if (decimals === 0) return Math.floor(num).toLocaleString();
            const actual = Number(num) / Math.pow(10, decimals);
            
            // âœ… ä¿®æ”¹è¿™é‡Œï¼šä½¿ç”¨ toFixed ä½†å»é™¤å°¾éƒ¨çš„ 0
            const rounded = actual.toFixed(decimals);
            const parts = rounded.split('.');
            
            // å»é™¤å°æ•°éƒ¨åˆ†æœ«å°¾çš„ 0
            let decimalPart = parts[1];
            if (decimalPart) {
                decimalPart = decimalPart.replace(/0+$/, ''); // å»é™¤å°¾éƒ¨çš„ 0
            }
            
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            // å¦‚æœå°æ•°éƒ¨åˆ†å®Œå…¨è¢«å»é™¤ï¼Œåªæ˜¾ç¤ºæ•´æ•°
            if (!decimalPart) {
                return '<span class="num-integer">' + parts[0] + '</span>';
            }
            
            return '<span class="num-integer">' + parts[0] + '</span><span class="num-decimal">.' + decimalPart + '</span>';
        }

        function formatNumberShort(num, decimals = 6) {
            const actual = Number(num) / Math.pow(10, decimals);
            if (actual >= 1000000) { const v = (actual / 1000000).toFixed(2).split('.'); return '<span class="num-integer">' + v[0] + '</span><span class="num-decimal">.' + v[1] + '</span>M'; }
            if (actual >= 1000) { const v = (actual / 1000).toFixed(2).split('.'); return '<span class="num-integer">' + v[0] + '</span><span class="num-decimal">.' + v[1] + '</span>K'; }
            const v = actual.toFixed(2).split('.');
            return '<span class="num-integer">' + v[0] + '</span><span class="num-decimal">.' + v[1] + '</span>';
        }

        function formatNumber(num, decimals = 6, maxLength = 20) {
            const actual = Number(num) / Math.pow(10, decimals);
            const parts = actual.toFixed(2).split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            if (parts.join('.').length > maxLength) return formatNumberShort(num, decimals);
            return formatNumberFull(num, decimals);
        }

        function formatAddress(addr) {
            if (!addr || addr === '0x0000000000000000000000000000000000000000') return '-';
            return addr.slice(0, 6) + '...' + addr.slice(-6);
        }

        function updateContractRuntime(startTimestamp) {
            if (runtimeInterval) clearInterval(runtimeInterval);
            function update() {
                const elapsed = Math.floor(Date.now() / 1000) - Number(startTimestamp);
                const d = Math.floor(elapsed / 86400), h = Math.floor((elapsed % 86400) / 3600), m = Math.floor((elapsed % 3600) / 60), s = elapsed % 60;
                document.getElementById('contractRuntime').textContent = d + 'å¤© ' + h + 'æ—¶ ' + m + 'åˆ† ' + s + 'ç§’';
            }
            update();
            runtimeInterval = setInterval(update, 1000);
        }

        function displayRankingState(ranking, globalRanking) {
            const stateA = document.getElementById('rankingStateA'), stateB = document.getElementById('rankingStateB'), stateC = document.getElementById('rankingStateC'), badge = document.getElementById('rankingBadge');
            stateA.style.display = 'none'; stateB.style.display = 'none'; stateC.style.display = 'none';
            if (!ranking.isCommunity) {
                stateA.style.display = 'block'; badge.textContent = 'æœªæˆä¸ºç¤¾åŒº';
                document.getElementById('communityFee').innerHTML = formatNumberFull(globalRanking.communityMintingFee, 6);
            } else if (!ranking.isRanked) {
                stateB.style.display = 'block'; badge.textContent = 'æš‚æœªå…¥æ¦œ';
                const myPerf = Number(ranking.performance), threshold = Number(globalRanking.thresholds?.[5] || 0), gap = threshold > myPerf ? threshold - myPerf : 0;
                document.getElementById('myPerformanceB').innerHTML = formatNumber(myPerf, 6);
                document.getElementById('top1000Threshold').innerHTML = formatNumber(threshold, 6);
                document.getElementById('gapToRanked').innerHTML = formatNumber(gap, 6);
            } else {
                stateC.style.display = 'block'; badge.textContent = 'æ­å–œå·²å…¥æ¦œ';
                document.getElementById('globalRank').textContent = '#' + ranking.globalRank;
                document.getElementById('layerRank').textContent = ranking.rankInLayer + '/' + ranking.layerTotal;
                document.getElementById('exchangeRate').textContent = ranking.exchangeRate + 'x';
                document.getElementById('myPerformanceC').innerHTML = formatNumber(ranking.performance, 6);
                const layerNames = ['', 'Top 10', 'Top 30', 'Top 100', 'Top 300', 'Top 600', 'Top 1000'];
                const lb = document.getElementById('layerBadge');
                lb.textContent = layerNames[ranking.layer] || '-';
                lb.className = 'layer-badge badge-layer' + ranking.layer;
            }
        }

        function loadLayersInfo(globalRanking) {
            const container = document.getElementById('layersContainer');
            container.innerHTML = '';
            const layerSizes = globalRanking.layerSizesArray || [], thresholds = globalRanking.thresholds || [];
            for (let i = 0; i < 6; i++) {
                const layerSize = Number(layerSizes[i] || 0), capacity = LAYER_CAPACITIES[i], threshold = thresholds[i] || 0;
                const isFull = layerSize >= capacity, statusText = isFull ? 'å·²æ»¡å‘˜' : 'æœªæ»¡å‘˜';
                const card = document.createElement('div');
                card.className = 'layer-card';
                card.innerHTML = '<div class="layer-header"><div class="layer-name">' + LAYER_NAMES[i] + '</div><div class="layer-status-badge"><span class="layer-status-text">' + statusText + '</span><span class="layer-badge badge-layer' + (i+1) + '">' + layerSize + '/' + capacity + '</span></div></div><div class="layer-threshold"><span class="threshold-label">æ™‹çº§é—¨æ§›</span><span class="threshold-value">' + formatNumberFull(threshold, 6) + ' Vollar</span></div>';
                container.appendChild(card);
            }
        }

        function createRankItem(rank, value, type) {
            const item = document.createElement('div');
            item.className = 'rank-item';
            let rankClass = 'rank-number';
            if (rank === 1) rankClass += ' rank-top1';
            else if (rank === 2) rankClass += ' rank-top2';
            else if (rank === 3) rankClass += ' rank-top3';
            const suffix = type === 'referral' ? ' VID' : ' V';
            item.innerHTML = '<div class="' + rankClass + '">' + rank + '</div><div class="rank-value">' + formatNumber(value, 6) + suffix + '</div>';
            return item;
        }

        async function loadLeaderboard(type) {
            const listId = type + 'List';
            const container = document.getElementById(listId);
            try {
                if (totalCommunities === 0) { totalCommunities = Number(await contract.methods.getMemberCount().call()); }
                if (totalCommunities === 0) { container.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“Š</div><div class="empty-text">æš‚æ— æ•°æ®</div></div>'; return; }
                const dataType = type === 'performance' ? 1 : type === 'minting' ? 2 : 3;
                const start = currentPage[type] * PAGE_SIZE;
                const end = Math.min(start + PAGE_SIZE, totalCommunities);
                if (start >= totalCommunities) return;
                const amounts = await contract.methods.getCommunityData(dataType, start, end).call();
                let dataArray = amounts.map((val, idx) => ({ index: start + idx, value: Number(val) }));
                dataArray.sort((a, b) => b.value - a.value);
                if (currentPage[type] === 0) { container.innerHTML = ''; } else { const oldBtn = container.querySelector('.load-more-btn'); if (oldBtn) oldBtn.remove(); }
                dataArray.forEach((item, idx) => { const rank = start + idx + 1; container.appendChild(createRankItem(rank, item.value, type)); });
                if (end < totalCommunities) {
                    const btn = document.createElement('button');
                    btn.className = 'load-more-btn';
                    btn.textContent = 'åŠ è½½æ›´å¤š (' + (totalCommunities - end) + ' æ¡)';
                    btn.onclick = () => { currentPage[type]++; loadLeaderboard(type); };
                    container.appendChild(btn);
                }
                leaderboardLoaded[type] = true;
            } catch (error) {
                console.error('åŠ è½½æ’è¡Œæ¦œå¤±è´¥:', error);
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-text">åŠ è½½å¤±è´¥</div></div>';
            }
        }

        async function loadData() {
            try {
                if (typeof web3Manager === 'undefined') { console.log('ç­‰å¾…web3ManageråŠ è½½...'); setTimeout(loadData, 500); return; }
                if (!web3Manager.web3) { await web3Manager.init(); }
                if (window.ethereum && window.ethereum.selectedAddress) { web3Manager.account = window.ethereum.selectedAddress; web3Manager.isConnected = true; }
                contract = web3Manager.getContract(TOKENBANK_ABI, CONFIG.CONTRACTS.TokenBank);
                if (!contract) { console.error('æ— æ³•è·å–åˆçº¦å®ä¾‹'); return; }
                const globalStats = await contract.methods.getGlobalStats().call();
                const rateStats = await contract.methods.getRateStats().call();
                const globalRanking = await contract.methods.getGlobalRankingInfo().call();
                document.getElementById('globalUsers').textContent = Number(globalStats.userCount).toLocaleString();
                document.getElementById('globalCommunities').textContent = Number(globalRanking.totalGlobalCommunities).toLocaleString();
                document.getElementById('globalMinted').innerHTML = formatNumber(globalStats.allTotalAmount, 6);
                document.getElementById('globalVID').innerHTML = formatNumber(globalStats.allTotalVIDResonance, 6) + ' VID';
                document.getElementById('globalUSDT').innerHTML = formatNumber(globalStats.allTotalUSDTResonance, 18) + ' USDT';
                document.getElementById('tokenTax').textContent = (Number(rateStats.tokenTax) / 100).toFixed(2) + '%';
                document.getElementById('interestRate').textContent = (Number(rateStats.interestRate) / 100).toFixed(2) + '%';
                updateContractRuntime(globalStats.startTimer);
                document.getElementById('rankedCount').textContent = Number(globalRanking.totalRankedCommunities) + '/1000';
                loadLayersInfo(globalRanking);
                totalCommunities = Number(globalRanking.totalGlobalCommunities);
                if (web3Manager.account) {
                    console.log('å·²è¿æ¥é’±åŒ…:', web3Manager.account);
                    const userInfo = await contract.methods.getUserInfo().call({ from: web3Manager.account });
                    document.getElementById('totalMinted').innerHTML = formatNumber(userInfo.totalMintedVollar, 6);
                    document.getElementById('vollarFromVID').innerHTML = formatNumber(userInfo.vollarFromVID, 6);
                    document.getElementById('vollarFromUSDT').innerHTML = formatNumber(userInfo.vollarFromUSDT, 6);
                    document.getElementById('vollarFromInterest').innerHTML = formatNumber(userInfo.personalHoldingInterest, 6);
                    document.getElementById('communitySubsidy').innerHTML = formatNumber(userInfo.communitySubsidyMint, 6);
                    document.getElementById('vidResonance').innerHTML = formatNumber(userInfo.vidResonanceAmount, 6) + ' VID';
                    document.getElementById('usdtResonance').innerHTML = formatNumber(userInfo.usdtResonanceAmount, 18) + ' USDT';
                    document.getElementById('refRewards').innerHTML = formatNumber(userInfo.vidRewardsFromRef, 6) + ' VID';
                    document.getElementById('communityRewards').innerHTML = formatNumber(userInfo.vidRewardsFromCommunity, 6) + ' VID';
                    document.getElementById('burnedVollar').innerHTML = formatNumber(userInfo.exchangedBurnedVollar, 6);
                    document.getElementById('exchangedBNB').innerHTML = formatNumber(userInfo.exchangedBNB, 18) + ' BNB';
                    document.getElementById('exchangedUSDT').innerHTML = formatNumber(userInfo.exchangedUSDT, 18) + ' USDT';
                    document.getElementById('exchangedVID').innerHTML = formatNumber(userInfo.exchangedVID, 6) + ' VID';
                    document.getElementById('usdtForVID').innerHTML = formatNumber(userInfo.usdtForVIDAmount, 18) + ' USDT';
                    document.getElementById('getTotalVID').innerHTML = formatNumber(userInfo.getTotalVID, 6) + ' VID';
                    const refStatus = await contract.methods.getUserRefInterestStatus().call({ from: web3Manager.account });
                    document.getElementById('myReferrer').textContent = formatAddress(refStatus.myReferrer);
                    document.getElementById('myReferrerCommunity').textContent = formatAddress(refStatus.myReferrerCommunity);
                    document.getElementById('totalFirstLevel').textContent = Number(refStatus.totalFirstLevelMembers);
                    document.getElementById('activeInterest').textContent = Number(refStatus.activeInterestCount);
                    document.getElementById('inactiveInterest').textContent = Number(refStatus.totalFirstLevelMembers) - Number(refStatus.activeInterestCount);
                    document.getElementById('teamBadge').textContent = refStatus.activeInterestCount + '/' + refStatus.totalFirstLevelMembers + ' ç”Ÿæ¯';
                    const rankingInfo = await contract.methods.getUserRankingInfo().call({ from: web3Manager.account });
                    const isCommunity = await contract.methods.amICommunityMember().call({ from: web3Manager.account });
                    displayRankingState({ isCommunity, isRanked: rankingInfo.isRanked, globalRank: Number(rankingInfo.globalRank), layer: Number(rankingInfo.layer), performance: rankingInfo.performance, rankInLayer: Number(rankingInfo.rankInLayer), layerTotal: Number(rankingInfo.layerTotal), exchangeRate: Number(rankingInfo.exchangeRate) }, globalRanking);
                } else {
                    console.log('é’±åŒ…æœªè¿æ¥');
                    document.getElementById('rankingBadge').textContent = 'æœªè¿æ¥é’±åŒ…';
                    document.getElementById('rankingStateA').style.display = 'block';
                    document.getElementById('communityFee').innerHTML = formatNumberFull(globalRanking.communityMintingFee, 6);
                }
                loadLeaderboard('performance');
                console.log('æ•°æ®åŠ è½½å®Œæˆ');
            } catch (error) { console.error('åŠ è½½æ•°æ®å¤±è´¥:', error); }
        }

        function switchTab(type) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(type).classList.add('active');
            if (!leaderboardLoaded[type]) { loadLeaderboard(type); }
        }

        function switchPage(page) {
            const pages = { 'home': 'index.html', 'stats': 'data.html', 'swap': 'exchange.html', 'temple': 'temple.html' };
            if (pages[page]) window.location.href = pages[page];
        }

        function refreshData() {
            const icon = document.getElementById('refreshIcon');
            icon.classList.add('spinning');
            currentPage = { performance: 0, minting: 0, referral: 0 };
            leaderboardLoaded = { performance: false, minting: false, referral: false };
            totalCommunities = 0;
            setTimeout(() => { icon.classList.remove('spinning'); loadData(); }, 500);
        }

        function goBack() { window.history.back(); }
        window.onload = function() { setTimeout(loadData, 100); };
    </script>
</body>
</html>
